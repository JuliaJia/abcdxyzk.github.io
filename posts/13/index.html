
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>kk Blog —— 通用基础</title>

  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kk Blog —— 通用基础" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/category.js" type="text/javascript"></script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kk Blog —— 通用基础</a></h1>
  
    <h2>慢慢搬迁中......</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="/search" method="get">
  <fieldset role="search">
    <input class="search" name="query" type="text" placeholder="Search..." x-webkit-speech />
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2014/02/28/debug-kgdb-breakpoint/">KGDB--Cannot insert breakpoint</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-28T17:55:00+08:00'><span class='date'>2014-02-28</span> <span class='time'>17:55:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>原因：</h4>

<p>内核编译选项CONFIG_DEBUG_RODATA，会对kernel text做write protect。 那么kgdb就不能设置断点了。</p>

<h4>解决方法是：</h4>

<p>编辑kernel source目录下生成的.config文件， 禁用CONFIG_DEBUG_RODATA=n (read only data)重新编译即可</p>

<hr />

<p><a href="http://www.mail-archive.com/kgdb-bugreport@lists.sourceforge.net/msg03464.html">http://www.mail-archive.com/kgdb-bugreport@lists.sourceforge.net/msg03464.html</a></p>

<blockquote><p>Hi Folks,</p>

<p>I&rsquo;m wondering if anyone has had issues with setting breakpoints. I&rsquo;m<br/>
able to break into the kernel, access data, do a backtrace, etc, but<br/>
when I attempt to set a breakpoint, then continue, I get the following error:</p>

<p>Cannot insert breakpoint 1.<br/>
Error accessing memory address 0xffffffff81310931: Unknown error 4294967295.</p>

<p>I&rsquo;m attaching a sample session, I had set remote debug to 1</p>

<p>Thanks!<br/>
Pat Thomson</p></blockquote>

<p>Hi Thomson,</p>

<p>It seems that your problem is the CONFIG_DEBUG_RODATA option was <br/>
enabled, It is recommend to turn CONFIG_DEBUG_RODATA off when using kgdb.</p>

<p> From the kgdb document(DocBook/kgdb.tmpl):</p>

<pre><code>If the architecture that you are using supports the kernel option
CONFIG_DEBUG_RODATA, you should consider turning it off.  This
option will prevent the use of software breakpoints because it
marks certain regions of the kernel's memory space as read-only.
If kgdb supports it for the architecture you are using, you can
use hardware breakpoints if you desire to run with the
CONFIG_DEBUG_RODATA option turned on, else you need to turn off
this option.
</code></pre>

<p>Thanks,
Dongdong</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2014/02/28/debug-2vm-connect/">Connecting Two Virtual Machines</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-28T17:50:00+08:00'><span class='date'>2014-02-28</span> <span class='time'>17:50:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  You can set up the virtual serial ports in two virtual machines to connect to each other. This is useful, for example, if you want to use an application in one virtual machine to capture debugging information sent from the other virtual machine&rsquo;s serial port.</p>

<p>  To install a direct serial connection between two virtual machines (a server and a client), take the following steps:</p>

<h4>Windows Host In the server virtual machine</h4>

<ol>
<li>Open the virtual machine settings editor (VM > Settings).</li>
<li>Click Add to start the Add Hardware Wizard.</li>
<li>Select Serial Port, then click Next.</li>
<li>Select Output to named pipe, then click Next.</li>
<li>Use the default pipe name, or enter another pipe name of your choice. The pipe name must follow the form \.\pipe\<namedpipe> — that is, it must begin with \.\pipe.</li>
<li>Select This end is the server.</li>
<li>Select The other end is a virtual machine.</li>
<li>By default, the device status setting is Connect at power on. You may deselect this setting if you wish.
Click Advanced if you want to configure this serial port to use polled mode. This option is of interest primarily to developers who are using debugging tools that communicate over a serial connection. For more information, see <a href="https://www.vmware.com/support/ws55/doc/ws_devices_serial_advanced.html">Special Configuration Options for Advanced Users.</a></li>
<li>Click Finish, then click OK to close the virtual machine settings editor.</li>
</ol>


<h4>In the client virtual machine</h4>

<ol>
<li>Open the virtual machine settings editor (VM > Settings).</li>
<li>Click Add to start the Add Hardware Wizard.</li>
<li>Select Serial Port, then click Next.</li>
<li>Select Use named pipe.</li>
<li>Use the default name, or enter another pipe name of your choice. The pipe name must follow the form \.\pipe\<namedpipe> — that is, it must begin with \.\pipe. The pipe name must be the same on both server and client.</li>
<li>Select This end is the client.</li>
<li>Select The other end is a virtual machine.</li>
<li>By default, the device status setting is Connect at power on. You may deselect this setting if you wish.
Click Advanced if you want to configure this serial port to use polled mode. This option is of interest primarily to developers who are using debugging tools that communicate over a serial connection. For more information, see <a href="https://www.vmware.com/support/ws55/doc/ws_devices_serial_advanced.html">Special Configuration Options for Advanced Users.</a></li>
<li>Click Finish, then click OK to close the virtual machine settings editor.</li>
</ol>


<h4>Linux Host In the server virtual machine</h4>

<ol>
<li>Open the virtual machine settings editor (VM > Settings).</li>
<li>Click Add to start the Add Hardware Wizard.</li>
<li>Select Serial Port, then click Next.</li>
<li>Select Output to named pipe, then click Next.</li>
<li>In the Path field, enter /tmp/<socket> or another Unix socket name of your choice.</li>
<li>Select This end is the server.</li>
<li>Select The other end is a virtual machine.</li>
<li>By default, the device status setting is Connect at power on. You may deselect this setting if you wish.
Click Advanced if you want to configure this serial port to use polled mode. This option is of interest primarily to developers who are using debugging tools that communicate over a serial connection. For more information, see <a href="https://www.vmware.com/support/ws55/doc/ws_devices_serial_advanced.html">Special Configuration Options for Advanced Users.</a></li>
<li>Click Finish, then click OK to save your configuration and close the virtual machine settings editor.</li>
</ol>


<h4>In the client virtual machine</h4>

<ol>
<li>Open the virtual machine settings editor (VM > Settings).</li>
<li>Click Add to start the Add Hardware Wizard.</li>
<li>Select Serial Port, then click Next.</li>
<li>Select Output to named pipe, then click Next.</li>
<li>In the Path field, enter /tmp/<socket> or another Unix socket name of your choice. The pipe name must be the same on both server and client.</li>
<li>Select This end is the client.</li>
<li>Select The other end is a virtual machine.</li>
<li>By default, the device status setting is Connect at power on. You may deselect this setting if you wish.
Click Advanced if you want to configure this serial port to use polled mode. This option is of interest primarily to developers who are using debugging tools that communicate over a serial connection. For more information, see <a href="https://www.vmware.com/support/ws55/doc/ws_devices_serial_advanced.html">Special Configuration Options for Advanced Users.</a></li>
<li>Click Finish, then click OK to save your configuration and close the virtual machine settings editor.</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2014/02/28/debug-vm-ttys/">vmware 串口调试</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-28T17:48:00+08:00'><span class='date'>2014-02-28</span> <span class='time'>17:48:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  在系统内核开发中，经常会用到串口调试，利用VMware的Virtual Machine更是为调试系统内核如虎添翼。那么怎么搭建串口调试环境呢？</p>

<p>Virtual Machine 主要有三种串口调试技术，可以在serial port的配置界面找到：</p>

<ol>
<li>Use physical serial port      即使用物理机串口，当用串口线盒另一台电脑连接时，就用这种方式</li>
<li>Use output file                   即把串口数据输出到宿主机某文件中，当只需要看输出结果的时候可以用这种方式，简单方便</li>
<li>Use named pipe                把串口输出到命名管道，命名管道可读可写，也就可以交互，进行一些debug工作，而不是简单的看结果</li>
</ol>


<p>  因为前两种相对简单易用就不具体介绍了，这里主要说第三种用命名管道调试方法。命名管道，在Linux中是进程间通信(IPC)的一种方式，两个进 程可以通过读写管道来交换数据。这里就是运用了这种技术，通过把串口绑定一个有名管道，对有名管道的读写交换串口数据。也有两种方式：1. 宿主机与虚拟机之间， 2. 在同一宿主机上，两虚拟机间通过绑定同一个宿主机上的有名管道。问题的关键在于如何把虚拟机串口绑定到宿主机的某一有名管道，而第一种方式则需要找到一种 方式使得主机如何读写有名管道来交互，经过一阵Google终于找到分别在Linux和Windows分别试验成功的工具。</p>

<p>  在Windows中有名管道式通过路径//./pipe/namedpipe来创建的，当然你可以指定到其他机子如//192.168.1.10 /pipe/namedpipe，而在Linux中，/tmp/mypipe就可以了。创建好有名管道后，就是如何和管道交互了。目前，无论是 Windows还是Linux，似乎都没有一款工具可以直接读写有名管道的，而我找到的两个工具都是通过把有名管道和Socket绑定，通过读写 Socket来间接读写管道。</p>

<h4>下面我就简要介绍一下在Windows和Linux下如何配置：</h4>

<h5>Linux Host:</h5>

<h6>Host  ~  Virtual Machine</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. configure VM
</span><span class='line'>a. add hardware -&gt; Serial port
</span><span class='line'>b. using named pipe
</span><span class='line'>c. /tmp/isocket
</span><span class='line'>d. this end is server & far end is application
</span><span class='line'>e. check Yield CPU on poll
</span><span class='line'>f. start Virtual Machine
</span><span class='line'>
</span><span class='line'>2. socat /tmp/isocket tcp4-listen:9001 &
</span><span class='line'>/tmp/socket: VMware call it 'named piped', actually it is Unix Daemon Socket, so you shouldn't use pipe:/tmp/socket
</span><span class='line'>3. telnet 127.0.0.1 9001</span></code></pre></td></tr></table></div></figure>


<p>Trouble Shoot: 有时候会遇到错误Connection closed by foreign host，或者telnet一开，socat就能退出，很可能是你没power on虚拟机，有名管道还没创建，你就socat，这样也会创建一个名为isocket的文件但只是普通文件。具体的细节请看socat help<br/>
start Virtual Machine first, than run the socat, and telnet<br/>
(Note you must have permission to all resource, /tmp/socket, VM and so on)</p>

<h6>Vritual Machine ~ Virtual Machine</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. configure VM
</span><span class='line'>a. add hardware --&gt;　serial port
</span><span class='line'>b. Using named pipe, configure /tmp/isocket 
</span><span class='line'>c.  this end is server & far end is Virtual Machine
</span><span class='line'>d. check Yield CPU on poll
</span><span class='line'>e. start VM
</span><span class='line'>
</span><span class='line'>2. Another VM
</span><span class='line'>a. add hardware  --&gt;  Serial Port
</span><span class='line'>b. Using named pipe, configure /tmp/isocket 
</span><span class='line'>c.  this end is client & far end is Virtual Machine 
</span><span class='line'>d. check Yield CPU on poll
</span><span class='line'>e. start VMs</span></code></pre></td></tr></table></div></figure>


<h5>Windows Host:</h5>

<h6>Host ~ Virtual Machine</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. configure VM
</span><span class='line'>a. add hardware --&gt; serial port
</span><span class='line'>b. using named pipe
</span><span class='line'>c. //./pipe/vmwaredebug
</span><span class='line'>d. this end is client & far end is application
</span><span class='line'>e. check Yield CPU on poll
</span><span class='line'>
</span><span class='line'>2. using 3rd-party tool to communicate with named pipe
</span><span class='line'>a. down the tool 
</span><span class='line'>b. install service
</span><span class='line'>cmd&gt;vmwaregateway.exe /r
</span><span class='line'>c. start service
</span><span class='line'>c:/&gt; net start vmwaregateway
</span><span class='line'>d. telnet 127.0.0.1 567
</span><span class='line'>3. start Virtual Machine</span></code></pre></td></tr></table></div></figure>


<p>如果你使用的是vmwaregateway.exe这个小工具，这里的管道名就必须是vmwaredebug，除非你把它的源代码download下来自己改改。</p>

<h6>Vritual Machine ~ Virtual Machine</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. configure VM
</span><span class='line'>a. add hardware --&gt;　serial port
</span><span class='line'>b. Using named pipe, //./pipe/vmwaredebug
</span><span class='line'>c.  this end is server & far end is Virtual Machine
</span><span class='line'>d. check Yield CPU on poll
</span><span class='line'>e. start VM
</span><span class='line'>
</span><span class='line'>2. Another VM
</span><span class='line'>a. add hardware  --&gt;  Serial Port
</span><span class='line'>b. Using named pipe, //./pipe/vmwaredebug
</span><span class='line'>c.  this end is client & far end is Virtual Machine 
</span><span class='line'>d. check Yield CPU on poll
</span><span class='line'>e. start VMs</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2014/01/09/lang-c-re-enter-fun/">可重入函数与不可重入函数</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-09T17:29:00+08:00'><span class='date'>2014-01-09</span> <span class='time'>17:29:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>可重入函数主要用于多任务环境中，简单来说就是可以被中断的函数，即在这个函数执行的任何时刻中断它，转入OS调度下去执行另外一段代 码，返回控制时不会出现什么错误；也意味着它除了使用自己栈上的变量以外不依赖于任何环境（包括static），这样的函数就是 purecode（纯代码）可重入，可以允许有该函数的多个副本在运行，由于它们使用的是分离的栈，所以不会互相干扰。而不可重入的函数由于使用了一些系 统资源，比如全局变量区、中断向量表等，所以它如果被中断的话，可能会出现问题，这类函数是不能运行在多任务环境下的。</p>

<p>可重入函数确实需要访问全局变量（包括 static），一定要注意实施互斥手段。它在并行运行环境中非常重要，但是一般要为访问全局变量付出一些性能代价。编写可重入函数时，若使用全局变量，则应通过关中断、信号量（即P、V操作）等手段对其加以保护。若对所使用的全局变量不加以保护，则此函数就不具有可重入性，即当多个进程调用此函数时，很有可能使有关全局变量变为不可知状态。</p>

<p>示例：假设Exam是 int型全局变量，函数Squre_Exam返回Exam平方值。那么如下函数不具有可重入性。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int Exam = 0;
</span><span class='line'>unsigned int example( int para )
</span><span class='line'>{
</span><span class='line'>    unsigned int temp;
</span><span class='line'>    Exam = para; // （**）
</span><span class='line'>     temp = Square_Exam( );
</span><span class='line'>    return temp;  
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>此函数若被多个进程调用的话，其结果可能是未知的，因为当（**）语句刚执行完后，另外一个使用本函数的进程可能正好被激活，那么当新激活的进程执行到此 函数时，将使Exam赋与另一个不同的para值，所以当控制重新回到“temp = Square_Exam( )”后，计算出的temp很可能不是预想中的结果。此函数应如下改进。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int Exam = 0;
</span><span class='line'>unsigned int example( int para )
</span><span class='line'>{
</span><span class='line'>    unsigned int temp;  
</span><span class='line'>    [申请信号量操作] //(1)  加锁  
</span><span class='line'>    Exam = para;  
</span><span class='line'>    temp = Square_Exam( );  
</span><span class='line'>    [释放信号量操作] //     解锁   
</span><span class='line'>    return temp;  
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>申请不到“信号量”，说明另外的进程正处于给Exam赋值并计算其平方过程中（即正在使用此信号）,本进程必须等待其释放信号后，才可继续执行。若申请到 信号，则可继续执行，但其它进程必须等待本进程释放信号量后，才能再使用本信号。保证函数的可重入性的方法：<br/>
     1、在写函数时候尽量使用局部变量（例如寄存器、堆栈中的变量）；<br/>
     2、对于要使用的全局变量要加以保护（如采取关中断、信号量等方法），这样构成的函数就一定是一个可重入的函数。</p>

<p>满足下列条件的函数多数是不可重入的：<br/>
     1、函数体内使用了静态的数据结构；<br/>
     2、函数体内调用了malloc()或者free()函数；<br/>
     3、函数体内调用了标准I/O函数。</p>

<p>如何将一个不可重入的函数改写成可重入函数呢？把一个不可重入函数变成可重入的唯一方法是用可重入规则来重写它。其实很简单，只要遵守了几条很容易理解的规则，那么写出来的函数就是可重入的：<br/>
     1、不要使用全局变量。因为别的代码很可能覆盖这些变量值。<br/>
     2、在和硬件发生交互的时候，切记执行类似disinterrupt()之类的操作，就是关闭硬件中断。完成交互记得打开中断，在有些系列上，这叫做“进入/ 退出核心”。<br/>
     3、不能调用其它任何不可重入的函数。<br/>
     4、谨慎使用堆栈。最好先在使用前先OS_ENTER_KERNAL。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/12/25/debug-kprobe-doc/">kprobes Documentation</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-25T14:04:00+08:00'><span class='date'>2013-12-25</span> <span class='time'>14:04:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://www.kernel.org/doc/Documentation/kprobes.txt">https://www.kernel.org/doc/Documentation/kprobes.txt</a></p>

<p>Documentation/kprobes.txt</p>

<h4>1.4 How Does Jump Optimization Work?</h4>

<p>If your kernel is built with CONFIG_OPTPROBES=y (currently this flag<br/>
is automatically set &lsquo;y&rsquo; on x86/x86-64, non-preemptive kernel) and<br/>
the &ldquo;debug.kprobes_optimization&rdquo; kernel parameter is set to 1 (see<br/>
sysctl(8)), Kprobes tries to reduce probe-hit overhead by using a jump<br/>
instruction instead of a breakpoint instruction at each probepoint.</p>

<h5>1.4.1 Init a Kprobe</h5>

<p>When a probe is registered, before attempting this optimization,<br/>
Kprobes inserts an ordinary, breakpoint-based kprobe at the specified<br/>
address. So, even if it&rsquo;s not possible to optimize this particular<br/>
probepoint, there&rsquo;ll be a probe there.</p>

<h5>1.4.2 Safety Check</h5>

<p>Before optimizing a probe, Kprobes performs the following safety checks:</p>

<ul>
<li><p>Kprobes verifies that the region that will be replaced by the jump<br/>
instruction (the &ldquo;optimized region&rdquo;) lies entirely within one function.<br/>
(A jump instruction is multiple bytes, and so may overlay multiple<br/>
instructions.)</p></li>
<li><p>Kprobes analyzes the entire function and verifies that there is no<br/>
jump into the optimized region.  Specifically:</p>

<ul>
<li>the function contains no indirect jump;</li>
<li>the function contains no instruction that causes an exception (since<br/>
the fixup code triggered by the exception could jump back into the<br/>
optimized region &ndash; Kprobes checks the exception tables to verify this);<br/>
and</li>
<li>there is no near jump to the optimized region (other than to the first<br/>
byte).</li>
</ul>
</li>
<li><p>For each instruction in the optimized region, Kprobes verifies that<br/>
the instruction can be executed out of line.</p></li>
</ul>


<h5>1.4.3 Preparing Detour Buffer</h5>

<p>Next, Kprobes prepares a &ldquo;detour&rdquo; buffer, which contains the following<br/>
instruction sequence:<br/>
- <span style="color:red">code to push the CPU&rsquo;s registers (emulating a breakpoint trap)</span><br/>
- <span style="color:red">a call to the trampoline code which calls user&rsquo;s probe handlers.</span><br/>
- <span style="color:red">code to restore registers</span><br/>
- <span style="color:red">the instructions from the optimized region</span><br/>
- <span style="color:red">a jump back to the original execution path.</span></p>

<h5>1.4.4 Pre-optimization</h5>

<p>After preparing the detour buffer, Kprobes verifies that none of the<br/>
following situations exist:<br/>
- <span style="color:red">The probe has either a break_handler (i.e., it&rsquo;s a jprobe) or a post_handler.</span><br/>
- <span style="color:red">Other instructions in the optimized region are probed.</span><br/>
- <span style="color:red">The probe is disabled.</span></p>

<p>In any of the above cases, Kprobes won&rsquo;t start optimizing the probe.<br/>
Since these are temporary situations, Kprobes tries to start<br/>
optimizing it again if the situation is changed.</p>

<p>If the kprobe can be optimized, Kprobes enqueues the kprobe to an<br/>
optimizing list, and kicks the kprobe-optimizer workqueue to optimize<br/>
it.  If the to-be-optimized probepoint is hit before being optimized,<br/>
Kprobes returns control to the original instruction path by setting<br/>
the CPU&rsquo;s instruction pointer to the copied code in the detour buffer<br/>
&ndash; thus at least avoiding the single-step.</p>

<h5>1.4.5 Optimization</h5>

<p>The Kprobe-optimizer doesn&rsquo;t insert the jump instruction immediately;<br/>
rather, it calls synchronize_sched() for safety first, because it&rsquo;s<br/>
possible for a CPU to be interrupted in the middle of executing the<br/>
optimized region(*).  As you know, synchronize_sched() can ensure<br/>
that all interruptions that were active when synchronize_sched()<br/>
was called are done, but only if CONFIG_PREEMPT=n.  So, this version<br/>
of kprobe optimization supports only kernels with CONFIG_PREEMPT=n.(**)</p>

<p>After that, the Kprobe-optimizer calls stop_machine() to replace<br/>
the optimized region with a jump instruction to the detour buffer,<br/>
using text_poke_smp().</p>

<h5>1.4.6 Unoptimization</h5>

<p>When an optimized kprobe is unregistered, disabled, or blocked by<br/>
another kprobe, it will be unoptimized.  If this happens before<br/>
the optimization is complete, the kprobe is just dequeued from the<br/>
optimized list.  If the optimization has been done, the jump is<br/>
replaced with the original code (except for an int3 breakpoint in<br/>
the first byte) by using text_poke_smp().</p>

<p>(<em>)Please imagine that the 2nd instruction is interrupted and then<br/>
the optimizer replaces the 2nd instruction with the jump </em>address*<br/>
while the interrupt handler is running. When the interrupt<br/>
returns to original address, there is no valid instruction,<br/>
and it causes an unexpected result.</p>

<p>(**)This optimization-safety checking may be replaced with the<br/>
stop-machine method that ksplice uses for supporting a CONFIG_PREEMPT=y<br/>
kernel.</p>

<p>NOTE for geeks:<br/>
<span style="color:red">The jump optimization changes the kprobe&rsquo;s pre_handler behavior.</span><br/>
<span style="color:red">Without optimization, the pre_handler can change the kernel&rsquo;s execution</span><br/>
<span style="color:red">path by changing regs->ip and returning 1.  However, when the probe</span><br/>
<span style="color:red">is optimized, that modification is ignored.  Thus, if you want to</span><br/>
<span style="color:red">tweak the kernel&rsquo;s execution path, you need to suppress optimization,</span><br/>
<span style="color:red">using one of the following techniques:</span><br/>
- <span style="color:blue">Specify an empty function for the kprobe&rsquo;s post_handler or break_handler.</span><br/>
 or<br/>
- <span style="color:blue">Execute &lsquo;sysctl -w debug.kprobes_optimization=n&rsquo;</span></p>

<p>&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;..</p>

<h4>5. Kprobes Features and Limitations</h4>

<p>Kprobes allows multiple probes at the same address.  Currently,<br/>
however, there cannot be multiple jprobes on the same function at<br/>
the same time.  Also, a probepoint for which there is a jprobe or<br/>
a post_handler cannot be optimized.  So if you install a jprobe,<br/>
or a kprobe with a post_handler, at an optimized probepoint, the<br/>
probepoint will be unoptimized automatically.</p>

<p>In general, you can install a probe anywhere in the kernel.<br/>
In particular, you can probe interrupt handlers.  Known exceptions<br/>
are discussed in this section.</p>

<p>The register_<em>probe functions will return -EINVAL if you attempt<br/>
to install a probe in the code that implements Kprobes (mostly<br/>
kernel/kprobes.c and arch/</em>/kernel/kprobes.c, but also functions such<br/>
as do_page_fault and notifier_call_chain).</p>

<p>If you install a probe in an inline-able function, Kprobes makes<br/>
no attempt to chase down all inline instances of the function and<br/>
install probes there.  gcc may inline a function without being asked,<br/>
so keep this in mind if you&rsquo;re not seeing the probe hits you expect.</p>

<p>A probe handler can modify the environment of the probed function<br/>
&ndash; e.g., by modifying kernel data structures, or by modifying the<br/>
contents of the pt_regs struct (which are restored to the registers<br/>
upon return from the breakpoint).  So Kprobes can be used, for example,<br/>
to install a bug fix or to inject faults for testing.  Kprobes, of<br/>
course, has no way to distinguish the deliberately injected faults<br/>
from the accidental ones.  Don&rsquo;t drink and probe.</p>

<p>Kprobes makes no attempt to prevent probe handlers from stepping on<br/>
each other &ndash; e.g., probing printk() and then calling printk() from a<br/>
probe handler.  If a probe handler hits a probe, that second probe&rsquo;s<br/>
handlers won&rsquo;t be run in that instance, and the kprobe.nmissed member<br/>
of the second probe will be incremented.</p>

<p>As of Linux v2.6.15-rc1, multiple handlers (or multiple instances of<br/>
the same handler) may run concurrently on different CPUs.</p>

<p>Kprobes does not use mutexes or allocate memory except during<br/>
registration and unregistration.</p>

<p>Probe handlers are run with preemption disabled.  Depending on the<br/>
architecture and optimization state, handlers may also run with<br/>
interrupts disabled (e.g., kretprobe handlers and optimized kprobe<br/>
handlers run without interrupt disabled on x86/x86-64).  In any case,<br/>
your handler should not yield the CPU (e.g., by attempting to acquire<br/>
a semaphore).</p>

<p>Since a return probe is implemented by replacing the return<br/>
address with the trampoline&rsquo;s address, stack backtraces and calls<br/>
to <code>__builtin_return_address()</code> will typically yield the trampoline&rsquo;s<br/>
address instead of the real return address for kretprobed functions.<br/>
(As far as we can tell, <code>__builtin_return_address()</code> is used only<br/>
for instrumentation and error reporting.)</p>

<p>If the number of times a function is called does not match the number<br/>
of times it returns, registering a return probe on that function may<br/>
produce undesirable results. In such a case, a line:<br/>
kretprobe BUG!: Processing kretprobe d000000000041aa8 @ c00000000004f48c<br/>
gets printed. With this information, one will be able to correlate the<br/>
exact instance of the kretprobe that caused the problem. We have the<br/>
do_exit() case covered. do_execve() and do_fork() are not an issue.<br/>
We&rsquo;re unaware of other specific cases where this could be a problem.</p>

<p>If, upon entry to or exit from a function, the CPU is running on<br/>
a stack other than that of the current task, registering a return<br/>
probe on that function may produce undesirable results.  For this<br/>
reason, Kprobes doesn&rsquo;t support return probes (or kprobes or jprobes)<br/>
on the x86_64 version of <code>__switch_to()</code>; the registration functions<br/>
return -EINVAL.</p>

<p><kk style="color:red">
On x86/x86-64, since the Jump Optimization of Kprobes modifies<br/>
instructions widely, there are some limitations to optimization. To<br/>
explain it, we introduce some terminology. Imagine a 3-instruction<br/>
sequence consisting of a two 2-byte instructions and one 3-byte<br/>
instruction.<br/>
</kk></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>        IA  
</span><span class='line'>         |  
</span><span class='line'>[-2][-1][0][1][2][3][4][5][6][7]  
</span><span class='line'>        [ins1][ins2][  ins3 ]  
</span><span class='line'>        [&lt;-     DCR       -&gt;]  
</span><span class='line'>           [&lt;- JTPR -&gt;]  </span></code></pre></td></tr></table></div></figure>


<p>
<kk style="color:red">
ins1: 1st Instruction<br/>
ins2: 2nd Instruction<br/>
ins3: 3rd Instruction<br/>
IA:  Insertion Address<br/>
JTPR: Jump Target Prohibition Region<br/>
DCR: Detoured Code Region<br/>
</kk></p>

<p><kk style="color:red">
The instructions in DCR are copied to the out-of-line buffer<br/>
of the kprobe, because the bytes in DCR are replaced by<br/>
a 5-byte jump instruction. So there are several limitations.<br/>
</kk></p>

<p><kk style="color:red">
a) The instructions in DCR must be relocatable.<br/>
b) The instructions in DCR must not include a call instruction.<br/>
c) JTPR must not be targeted by any jump or call instruction.<br/>
d) DCR must not straddle the border between functions.<br/>
</kk></p>

<p><kk style="color:red">
Anyway, these limitations are checked by the in-kernel instruction<br/>
decoder, so you don&rsquo;t need to worry about that.<br/>
</kk></p>

<h4>6. Probe Overhead</h4>

<p>On a typical CPU in use in 2005, a kprobe hit takes 0.5 to 1.0<br/>
microseconds to process.  Specifically, a benchmark that hits the same<br/>
probepoint repeatedly, firing a simple handler each time, reports 1-2<br/>
million hits per second, depending on the architecture.  A jprobe or<br/>
return-probe hit typically takes 50-75% longer than a kprobe hit.<br/>
When you have a return probe set on a function, adding a kprobe at<br/>
the entry to that function adds essentially no overhead.</p>

<p>Here are sample overhead figures (in usec) for different architectures.<br/>
k = kprobe; j = jprobe; r = return probe; kr = kprobe + return probe<br/>
on same function; jr = jprobe + return probe on same function</p>

<p>i386: Intel Pentium M, 1495 MHz, 2957.31 bogomips<br/>
k = 0.57 usec; j = 1.00; r = 0.92; kr = 0.99; jr = 1.40</p>

<p>x86_64: AMD Opteron 246, 1994 MHz, 3971.48 bogomips<br/>
k = 0.49 usec; j = 0.76; r = 0.80; kr = 0.82; jr = 1.07</p>

<p>ppc64: POWER5 (gr), 1656 MHz (SMT disabled, 1 virtual CPU per physical CPU)<br/>
k = 0.77 usec; j = 1.31; r = 1.26; kr = 1.45; jr = 1.99</p>

<h5>6.1 Optimized Probe Overhead</h5>

<p>Typically, an optimized kprobe hit takes 0.07 to 0.1 microseconds to<br/>
process. Here are sample overhead figures (in usec) for x86 architectures.<br/>
k = unoptimized kprobe, b = boosted (single-step skipped), o = optimized kprobe,<br/>
r = unoptimized kretprobe, rb = boosted kretprobe, ro = optimized kretprobe.</p>

<p>i386: Intel&reg; Xeon&reg; E5410, 2.33GHz, 4656.90 bogomips<br/>
k = 0.80 usec; b = 0.33; o = 0.05; r = 1.10; rb = 0.61; ro = 0.33</p>

<p>x86-64: Intel&reg; Xeon&reg; E5410, 2.33GHz, 4656.90 bogomips<br/>
<span style="color:red">k = 0.99 usec; b = 0.43; o = 0.06; r = 1.24; rb = 0.68; ro = 0.30</span></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/14">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/12">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/language/'>language</a><a href='##' onmousedown=showDiv('language') id='aexp_language'><span class='exp_style' id='exp_language'>[+]</span></a><span class='right_span'>(28)</span></li>
<div id='language' class='catsub'><li><a href='/blog/cats/language~c/?opendiv=language'>c</a><a href='##' onmousedown=showDiv('language~c') id='aexp_language~c'><span class='exp_style' id='exp_language~c'>[+]</span></a><span class='right_span'>15</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~c')) document.getElementById('aexp_language~c').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~css/?opendiv=language'>css</a><a href='##' onmousedown=showDiv('language~css') id='aexp_language~css'><span class='exp_style' id='exp_language~css'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~css')) document.getElementById('aexp_language~css').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~java/?opendiv=language'>java</a><a href='##' onmousedown=showDiv('language~java') id='aexp_language~java'><span class='exp_style' id='exp_language~java'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~java')) document.getElementById('aexp_language~java').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~php/?opendiv=language'>php</a><a href='##' onmousedown=showDiv('language~php') id='aexp_language~php'><span class='exp_style' id='exp_language~php'>[+]</span></a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('language')) document.getElementById('aexp_language').style.visibility = 'hidden';
if (!document.getElementById('language~php')) document.getElementById('aexp_language~php').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/compiler/'>compiler</a><a href='##' onmousedown=showDiv('compiler') id='aexp_compiler'><span class='exp_style' id='exp_compiler'>[+]</span></a><span class='right_span'>(7)</span></li>
<div id='compiler' class='catsub'><li><a href='/blog/cats/compiler~base/?opendiv=compiler'>base</a><a href='##' onmousedown=showDiv('compiler~base') id='aexp_compiler~base'><span class='exp_style' id='exp_compiler~base'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~base')) document.getElementById('aexp_compiler~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~ld/?opendiv=compiler'>ld</a><a href='##' onmousedown=showDiv('compiler~ld') id='aexp_compiler~ld'><span class='exp_style' id='exp_compiler~ld'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~ld')) document.getElementById('aexp_compiler~ld').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~lib/?opendiv=compiler'>lib</a><a href='##' onmousedown=showDiv('compiler~lib') id='aexp_compiler~lib'><span class='exp_style' id='exp_compiler~lib'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~lib')) document.getElementById('aexp_compiler~lib').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~make/?opendiv=compiler'>make</a><a href='##' onmousedown=showDiv('compiler~make') id='aexp_compiler~make'><span class='exp_style' id='exp_compiler~make'>[+]</span></a><span class='right_span'>4</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler')) document.getElementById('aexp_compiler').style.visibility = 'hidden';
if (!document.getElementById('compiler~make')) document.getElementById('aexp_compiler~make').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/assembly/'>assembly</a><a href='##' onmousedown=showDiv('assembly') id='aexp_assembly'><span class='exp_style' id='exp_assembly'>[+]</span></a><span class='right_span'>(2)</span></li>
<div id='assembly' class='catsub'><li><a href='/blog/cats/assembly~base/?opendiv=assembly'>base</a><a href='##' onmousedown=showDiv('assembly~base') id='aexp_assembly~base'><span class='exp_style' id='exp_assembly~base'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly')) document.getElementById('aexp_assembly').style.visibility = 'hidden';
if (!document.getElementById('assembly~base')) document.getElementById('aexp_assembly~base').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/system/'>system</a><a href='##' onmousedown=showDiv('system') id='aexp_system'><span class='exp_style' id='exp_system'>[+]</span></a><span class='right_span'>(45)</span></li>
<div id='system' class='catsub'><li><a href='/blog/cats/system~abrt/?opendiv=system'>abrt</a><a href='##' onmousedown=showDiv('system~abrt') id='aexp_system~abrt'><span class='exp_style' id='exp_system~abrt'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~abrt')) document.getElementById('aexp_system~abrt').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~base/?opendiv=system'>base</a><a href='##' onmousedown=showDiv('system~base') id='aexp_system~base'><span class='exp_style' id='exp_system~base'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~base')) document.getElementById('aexp_system~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~centos/?opendiv=system'>centos</a><a href='##' onmousedown=showDiv('system~centos') id='aexp_system~centos'><span class='exp_style' id='exp_system~centos'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~centos')) document.getElementById('aexp_system~centos').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~command/?opendiv=system'>command</a><a href='##' onmousedown=showDiv('system~command') id='aexp_system~command'><span class='exp_style' id='exp_system~command'>[+]</span></a><span class='right_span'>7</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~command')) document.getElementById('aexp_system~command').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~freebsd/?opendiv=system'>freebsd</a><a href='##' onmousedown=showDiv('system~freebsd') id='aexp_system~freebsd'><span class='exp_style' id='exp_system~freebsd'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~freebsd')) document.getElementById('aexp_system~freebsd').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~mysql/?opendiv=system'>mysql</a><a href='##' onmousedown=showDiv('system~mysql') id='aexp_system~mysql'><span class='exp_style' id='exp_system~mysql'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~mysql')) document.getElementById('aexp_system~mysql').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~rpm/?opendiv=system'>rpm</a><a href='##' onmousedown=showDiv('system~rpm') id='aexp_system~rpm'><span class='exp_style' id='exp_system~rpm'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~rpm')) document.getElementById('aexp_system~rpm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~tools/?opendiv=system'>tools</a><a href='##' onmousedown=showDiv('system~tools') id='aexp_system~tools'><span class='exp_style' id='exp_system~tools'>[+]</span></a><span class='right_span'>20</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~tools')) document.getElementById('aexp_system~tools').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~ubuntu/?opendiv=system'>ubuntu</a><a href='##' onmousedown=showDiv('system~ubuntu') id='aexp_system~ubuntu'><span class='exp_style' id='exp_system~ubuntu'>[+]</span></a><span class='right_span'>5</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('system')) document.getElementById('aexp_system').style.visibility = 'hidden';
if (!document.getElementById('system~ubuntu')) document.getElementById('aexp_system~ubuntu').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/kernel/'>kernel</a><a href='##' onmousedown=showDiv('kernel') id='aexp_kernel'><span class='exp_style' id='exp_kernel'>[+]</span></a><span class='right_span'>(11)</span></li>
<div id='kernel' class='catsub'><li><a href='/blog/cats/kernel~base/?opendiv=kernel'>base</a><a href='##' onmousedown=showDiv('kernel~base') id='aexp_kernel~base'><span class='exp_style' id='exp_kernel~base'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~base')) document.getElementById('aexp_kernel~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~kexec/?opendiv=kernel'>kexec</a><a href='##' onmousedown=showDiv('kernel~kexec') id='aexp_kernel~kexec'><span class='exp_style' id='exp_kernel~kexec'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~kexec')) document.getElementById('aexp_kernel~kexec').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~mm/?opendiv=kernel'>mm</a><a href='##' onmousedown=showDiv('kernel~mm') id='aexp_kernel~mm'><span class='exp_style' id='exp_kernel~mm'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~mm')) document.getElementById('aexp_kernel~mm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~net/?opendiv=kernel'>net</a><a href='##' onmousedown=showDiv('kernel~net') id='aexp_kernel~net'><span class='exp_style' id='exp_kernel~net'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel')) document.getElementById('aexp_kernel').style.visibility = 'hidden';
if (!document.getElementById('kernel~net')) document.getElementById('aexp_kernel~net').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/debug/'>debug</a><a href='##' onmousedown=showDiv('debug') id='aexp_debug'><span class='exp_style' id='exp_debug'>[+]</span></a><span class='right_span'>(31)</span></li>
<div id='debug' class='catsub'><li><a href='/blog/cats/debug~base/?opendiv=debug'>base</a><a href='##' onmousedown=showDiv('debug~base') id='aexp_debug~base'><span class='exp_style' id='exp_debug~base'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~base')) document.getElementById('aexp_debug~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~debugedit/?opendiv=debug'>debugedit</a><a href='##' onmousedown=showDiv('debug~debugedit') id='aexp_debug~debugedit'><span class='exp_style' id='exp_debug~debugedit'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~debugedit')) document.getElementById('aexp_debug~debugedit').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~dwarf/?opendiv=debug'>dwarf</a><a href='##' onmousedown=showDiv('debug~dwarf') id='aexp_debug~dwarf'><span class='exp_style' id='exp_debug~dwarf'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~dwarf')) document.getElementById('aexp_debug~dwarf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~gdb/?opendiv=debug'>gdb</a><a href='##' onmousedown=showDiv('debug~gdb') id='aexp_debug~gdb'><span class='exp_style' id='exp_debug~gdb'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~gdb')) document.getElementById('aexp_debug~gdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kdump,-crash/?opendiv=debug'>kdump、crash</a><a href='##' onmousedown=showDiv('debug~kdump、crash') id='aexp_debug~kdump、crash'><span class='exp_style' id='exp_debug~kdump、crash'>[+]</span></a><span class='right_span'>7</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kdump、crash')) document.getElementById('aexp_debug~kdump、crash').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kgdb/?opendiv=debug'>kgdb</a><a href='##' onmousedown=showDiv('debug~kgdb') id='aexp_debug~kgdb'><span class='exp_style' id='exp_debug~kgdb'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kgdb')) document.getElementById('aexp_debug~kgdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kprobe/?opendiv=debug'>kprobe</a><a href='##' onmousedown=showDiv('debug~kprobe') id='aexp_debug~kprobe'><span class='exp_style' id='exp_debug~kprobe'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kprobe')) document.getElementById('aexp_debug~kprobe').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~systemtap/?opendiv=debug'>systemtap</a><a href='##' onmousedown=showDiv('debug~systemtap') id='aexp_debug~systemtap'><span class='exp_style' id='exp_debug~systemtap'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('debug')) document.getElementById('aexp_debug').style.visibility = 'hidden';
if (!document.getElementById('debug~systemtap')) document.getElementById('aexp_debug~systemtap').style.visibility = 'hidden';
</script>
<li><div style="background:#DDD; height:0.3em;"></div></li><li class='catclass'><a href='/blog/cats/algorithm/'>algorithm</a><a href='##' onmousedown=showDiv('algorithm') id='aexp_algorithm'><span class='exp_style' id='exp_algorithm'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='algorithm' class='catsub'><li><a href='/blog/cats/algorithm~base/?opendiv=algorithm'>base</a><a href='##' onmousedown=showDiv('algorithm~base') id='aexp_algorithm~base'><span class='exp_style' id='exp_algorithm~base'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~base')) document.getElementById('aexp_algorithm~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~ds/?opendiv=algorithm'>ds</a><a href='##' onmousedown=showDiv('algorithm~ds') id='aexp_algorithm~ds'><span class='exp_style' id='exp_algorithm~ds'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~ds')) document.getElementById('aexp_algorithm~ds').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~tc/?opendiv=algorithm'>tc</a><a href='##' onmousedown=showDiv('algorithm~tc') id='aexp_algorithm~tc'><span class='exp_style' id='exp_algorithm~tc'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~tc')) document.getElementById('aexp_algorithm~tc').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~top/?opendiv=algorithm'>top</a><a href='##' onmousedown=showDiv('algorithm~top') id='aexp_algorithm~top'><span class='exp_style' id='exp_algorithm~top'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~top')) document.getElementById('aexp_algorithm~top').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~tree/?opendiv=algorithm'>tree</a><a href='##' onmousedown=showDiv('algorithm~tree') id='aexp_algorithm~tree'><span class='exp_style' id='exp_algorithm~tree'>[+]</span></a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm')) document.getElementById('aexp_algorithm').style.visibility = 'hidden';
if (!document.getElementById('algorithm~tree')) document.getElementById('aexp_algorithm~tree').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/blog/'>blog</a><a href='##' onmousedown=showDiv('blog') id='aexp_blog'><span class='exp_style' id='exp_blog'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='blog' class='catsub'><li><a href='/blog/cats/blog~hello/?opendiv=blog'>hello</a><a href='##' onmousedown=showDiv('blog~hello') id='aexp_blog~hello'><span class='exp_style' id='exp_blog~hello'>[+]</span></a><span class='right_span'>1</span></li>
<div id='blog~hello' class='catsub2'><li><a href='/blog/cats/blog~hello~hi/?opendiv=blog~hello'>hi</a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~hello')) document.getElementById('aexp_blog~hello').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~jekyll/?opendiv=blog'>jekyll</a><a href='##' onmousedown=showDiv('blog~jekyll') id='aexp_blog~jekyll'><span class='exp_style' id='exp_blog~jekyll'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~jekyll')) document.getElementById('aexp_blog~jekyll').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~markdown/?opendiv=blog'>markdown</a><a href='##' onmousedown=showDiv('blog~markdown') id='aexp_blog~markdown'><span class='exp_style' id='exp_blog~markdown'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~markdown')) document.getElementById('aexp_blog~markdown').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~octopress/?opendiv=blog'>octopress</a><a href='##' onmousedown=showDiv('blog~octopress') id='aexp_blog~octopress'><span class='exp_style' id='exp_blog~octopress'>[+]</span></a><span class='right_span'>5</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog')) document.getElementById('aexp_blog').style.visibility = 'hidden';
if (!document.getElementById('blog~octopress')) document.getElementById('aexp_blog~octopress').style.visibility = 'hidden';
</script>

</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Date Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/2014/'>2014</a><a href='##' onmousedown=showDiv('2014')><span class='exp_style' id='exp_2014'>[+]</span></a><span class='right_span'>(64)</span></li>
<div id='2014' class='catsub'><li><a href='/blog/cats/2014~11/?opendiv=2014'>2014-11</a><span class='right_span'>18</span></li>
<li><a href='/blog/cats/2014~10/?opendiv=2014'>2014-10</a><span class='right_span'>10</span></li>
<li><a href='/blog/cats/2014~09/?opendiv=2014'>2014-09</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2014~08/?opendiv=2014'>2014-08</a><span class='right_span'>14</span></li>
<li><a href='/blog/cats/2014~07/?opendiv=2014'>2014-07</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~06/?opendiv=2014'>2014-06</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2014~05/?opendiv=2014'>2014-05</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2014~04/?opendiv=2014'>2014-04</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2014~03/?opendiv=2014'>2014-03</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2014~02/?opendiv=2014'>2014-02</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2014~01/?opendiv=2014'>2014-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2013/'>2013</a><a href='##' onmousedown=showDiv('2013')><span class='exp_style' id='exp_2013'>[+]</span></a><span class='right_span'>(31)</span></li>
<div id='2013' class='catsub'><li><a href='/blog/cats/2013~12/?opendiv=2013'>2013-12</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2013~11/?opendiv=2013'>2013-11</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2013~10/?opendiv=2013'>2013-10</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2013~09/?opendiv=2013'>2013-09</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2013~08/?opendiv=2013'>2013-08</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2013~06/?opendiv=2013'>2013-06</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~05/?opendiv=2013'>2013-05</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~03/?opendiv=2013'>2013-03</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2013~02/?opendiv=2013'>2013-02</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2012/'>2012</a><a href='##' onmousedown=showDiv('2012')><span class='exp_style' id='exp_2012'>[+]</span></a><span class='right_span'>(24)</span></li>
<div id='2012' class='catsub'><li><a href='/blog/cats/2012~11/?opendiv=2012'>2012-11</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2012~10/?opendiv=2012'>2012-10</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~05/?opendiv=2012'>2012-05</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~04/?opendiv=2012'>2012-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2012~03/?opendiv=2012'>2012-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2012~02/?opendiv=2012'>2012-02</a><span class='right_span'>4</span></li>
</div><li class='catclass'><a href='/blog/cats/2011/'>2011</a><a href='##' onmousedown=showDiv('2011')><span class='exp_style' id='exp_2011'>[+]</span></a><span class='right_span'>(12)</span></li>
<div id='2011' class='catsub'><li><a href='/blog/cats/2011~12/?opendiv=2011'>2011-12</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~11/?opendiv=2011'>2011-11</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2011~08/?opendiv=2011'>2011-08</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~07/?opendiv=2011'>2011-07</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~06/?opendiv=2011'>2011-06</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~05/?opendiv=2011'>2011-05</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~04/?opendiv=2011'>2011-04</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~03/?opendiv=2011'>2011-03</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~01/?opendiv=2011'>2011-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2010/'>2010</a><a href='##' onmousedown=showDiv('2010')><span class='exp_style' id='exp_2010'>[+]</span></a><span class='right_span'>(1)</span></li>
<div id='2010' class='catsub'><li><a href='/blog/cats/2010~07/?opendiv=2010'>2010-07</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2009/'>2009</a><a href='##' onmousedown=showDiv('2009')><span class='exp_style' id='exp_2009'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='2009' class='catsub'><li><a href='/blog/cats/2009~12/?opendiv=2009'>2009-12</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2009~10/?opendiv=2009'>2009-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2009~09/?opendiv=2009'>2009-09</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2009~07/?opendiv=2009'>2009-07</a><span class='right_span'>1</span></li>
</div>
</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Tags</h1>
<ul class="tag-cloud">
<a style="font-size: 100%" href="/tags/ld-preload/">LD_PRELOAD(1)</a>
<a style="font-size: 100%" href="/tags/thunderbird/">Thunderbird(1)</a>
<a style="font-size: 100%" href="/tags/abrt/">abrt(1)</a>
<a style="font-size: 100%" href="/tags/algorithm/">algorithm(1)</a>
<a style="font-size: 100%" href="/tags/binutils/">binutils(1)</a>
<a style="font-size: 100%" href="/tags/centos/">centos(1)</a>
<a style="font-size: 126%" href="/tags/ci/">ci(3)</a>
<a style="font-size: 117%" href="/tags/crash/">crash(2)</a>
<a style="font-size: 117%" href="/tags/dwarf/">dwarf(2)</a>
<a style="font-size: 117%" href="/tags/ftp/">ftp(2)</a>
<a style="font-size: 143%" href="/tags/gdb/">gdb(6)</a>
<a style="font-size: 143%" href="/tags/git/">git(6)</a>
<a style="font-size: 100%" href="/tags/grub/">grub(1)</a>
<a style="font-size: 100%" href="/tags/grubby/">grubby(1)</a>
<a style="font-size: 100%" href="/tags/hello/">hello(1)</a>
<a style="font-size: 100%" href="/tags/hydra/">hydra(1)</a>
<a style="font-size: 150%" href="/tags/judge/">judge(8)</a>
<a style="font-size: 117%" href="/tags/kdump/">kdump(2)</a>
<a style="font-size: 150%" href="/tags/koj/">koj(8)</a>
<a style="font-size: 100%" href="/tags/makedumpfile/">makedumpfile(1)</a>
<a style="font-size: 100%" href="/tags/markdown/">markdown(1)</a>
<a style="font-size: 117%" href="/tags/nvidia/">nvidia(2)</a>
<a style="font-size: 139%" href="/tags/octopress/">octopress(5)</a>
<a style="font-size: 139%" href="/tags/oj/">oj(5)</a>
<a style="font-size: 100%" href="/tags/opcode/">opcode(1)</a>
<a style="font-size: 100%" href="/tags/patch/">patch(1)</a>
<a style="font-size: 100%" href="/tags/reg-exp/">reg_exp(1)</a>
<a style="font-size: 100%" href="/tags/rpm/">rpm(1)</a>
<a style="font-size: 100%" href="/tags/screen/">screen(1)</a>
<a style="font-size: 117%" href="/tags/ssh/">ssh(2)</a>
<a style="font-size: 100%" href="/tags/syslog/">syslog(1)</a>
<a style="font-size: 100%" href="/tags/vim/">vim(1)</a>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/27/tools-reg-exp-base/">正则表达式常用字符</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/27/blog-octopress-jekyll/">jekyll的一些全局变量</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/25/octopress-5/">octopress优化</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/20/octopress-4/">octopress 加站长统计和站内搜索</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/17/blog-markdown/">markdown部分语法</a>
      </li>
    
  </ul>
</section>
<section>
<h1>Links</h1>
<ul>
	<li>
		<a href=http://hi.baidu.com/abcdxyzk target=_blank>My blog</a>
	</li>
</ul>
</section>

  
<section id="comment_sidebar">
<h1>Recent Comments</h1>

<script type="text/javascript" src="http://abcdxyzk.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=20"></script><a href="http://disqus.com/">Powered by Disqus</a>

</section>


</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - kk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Top" href="#" id="scroll2top" style="position: fixed; height: 50px; bottom: 50px; right: 30px; cursor: pointer; z-index: 9999; display: block; opacity: 1;"><img src="/images/scrollup.png"></a>
  <script src="/javascripts/scroll2top.js"></script>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abcdxyzk';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 2014 | kk Blog —— 通用基础]]></title>
  <link href="http://abcdxyzk.github.io/blog/cats/2014/atom.xml" rel="self"/>
  <link href="http://abcdxyzk.github.io/"/>
  <updated>2014-12-23T01:47:18+08:00</updated>
  <id>http://abcdxyzk.github.io/</id>
  <author>
    <name><![CDATA[kk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[内核模块编译怎样绕过insmod时的版本检查]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/12/22/kernel-vermagic/"/>
    <updated>2014-12-22T22:15:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/12/22/kernel-vermagic</id>
    <content type="html"><![CDATA[<p><a href="http://blog.sina.com.cn/s/blog_53931eca01015uky.html">http://blog.sina.com.cn/s/blog_53931eca01015uky.html</a></p>

<p>在開發kernel driver時，總是會遇到討人厭的vermagic檢查，只要目前在run的kernel版本跟driver編譯時用的kernel版本不一致，就沒辦法insmod。
<code>
    bash-3.2# insmod sdio.ko
    sdio: version magic '2.6.28-271-gec75a15 preempt mod_unload modversions ARMv7 '
    should be '2.6.28 preempt mod_unload ARMv7 '
    insmod: init_module 'sdio.ko' failed (Exec format error)
</code>
這大大降低了開發速度，尤其是當你拿不到客戶在用的kernel時，又要開發driver給他用，真的是很麻煩……</p>

<p>那麼要怎麼利用噁心的方式繞過去呢???</p>

<h5>一、先把 Moudle version 檢查關掉。</h5>

<pre><code>user@host # ARCH=arm make menuconfig
    --- Enable loadable module support                                             │ │
    │ │         [ ]   Forced module loading                                      │ │
    │ │         [*]   Module unloading                                           │ │
    │ │         [*]     Forced module unloading                                  │ │
    │ │         [ ]   Module versioning support                                  │ │
    │ │         [ ]   Source checksum for all modules
</code></pre>

<h5>二、 使用modinfo時，可以看到目前這driver的vermagic</h5>

<pre><code>    filename: external_drivers/omap3530/Linux/sdio/sdio.ko
    author: Texas Instruments Inc
    alias: TIWLAN_SDIO
    license: GPL
    description: TI WLAN SDIO driver
    depends:
    vermagic: 2.6.28-271-gec75a15 preempt mod_unload ARMv7
    parm: g_sdio_debug_level:debug level (int)
</code></pre>

<h5>三、 修改 kernel 的 vermagic，再重新編譯driver</h5>

<p>vermagic 的第一個值 2.6.28-noneed 是由這 include/linux/utsrelease.h裡的 UTS_RELEASE 所定義。
<code>
    #define UTS_RELEASE "2.6.28-271-gec75a15"
</code>
之後再由 include/linux/vermagic.h 裡的 macro<br/>
去組合出 VERMAGIC_STRING ， 也就是 kernel 的vermagic。
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;generated/utsrelease.h&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;#ifdef CONFIG_SMP
</span><span class='line'>#define MODULE_VERMAGIC_SMP "SMP "
</span><span class='line'>#else
</span><span class='line'>#define MODULE_VERMAGIC_SMP ""
</span><span class='line'>#endif
</span><span class='line'>#ifdef CONFIG_PREEMPT
</span><span class='line'>#define MODULE_VERMAGIC_PREEMPT "preempt "
</span><span class='line'>#else
</span><span class='line'>#define MODULE_VERMAGIC_PREEMPT ""
</span><span class='line'>#endif完成編譯後，你就可以得
</span><span class='line'>#ifdef CONFIG_MODULE_UNLOAD
</span><span class='line'>#define MODULE_VERMAGIC_MODULE_UNLOAD "mod_unload "
</span><span class='line'>#else
</span><span class='line'>#define MODULE_VERMAGIC_MODULE_UNLOAD ""
</span><span class='line'>#endif
</span><span class='line'>#ifndef CONFIG_MODVERSIONS
</span><span class='line'>#define MODULE_VERMAGIC_MODVERSIONS "modversions "
</span><span class='line'>#else
</span><span class='line'>#define MODULE_VERMAGIC_MODVERSIONS ""
</span><span class='line'>#endif
</span><span class='line'>#ifndef MODULE_ARCH_VERMAGIC
</span><span class='line'>#define MODULE_ARCH_VERMAGIC ""
</span><span class='line'>#endif
</span><span class='line'>
</span><span class='line'>#define VERMAGIC_STRING \
</span><span class='line'>UTS_RELEASE " " \
</span><span class='line'>MODULE_VERMAGIC_SMP MODULE_VERMAGIC_PREEMPT \
</span><span class='line'>MODULE_VERMAGIC_MODULE_UNLOAD MODULE_VERMAGIC_MODVERSIONS \
</span><span class='line'>MODULE_ARCH_VERMAGIC
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;所以， 我們只要把 UTS_RELEASE 改成我們的數字即可，當然若是懶得去try組合後的字串，也可以直接將VERMAGIC_STRING改成你要的字串
</span><span class='line'>
</span><span class='line'>建議修改完 vermagic.h, utsrelease.h後，還是把kernel重編完再編kernel，比較保險。
</span><span class='line'>
</span><span class='line'>以下是修改後，用modinfo看的結果
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;filename: external_drivers/omap3530/Linux/sdio/sdio.ko
</span><span class='line'>author: Texas Instruments Inc
</span><span class='line'>alias: TIWLAN_SDIO
</span><span class='line'>license: GPL
</span><span class='line'>description: TI WLAN SDIO driver
</span><span class='line'>depends:
</span><span class='line'>vermagic: 2.6.28 preempt mod_unload ARMv7
</span><span class='line'>parm: g_sdio_debug_level:debug level (int)
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;
</span><span class='line'>-------------
</span><span class='line'>-------------
</span><span class='line'>
</span><span class='line'>另外若你是用git 做版本控制 , 那就會出現git的版本號在kernel 編號上  
</span><span class='line'>所以要把他關掉
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;General setup  ---&gt;
</span><span class='line'> [ ] Automatically append version information to the version strin
</span><span class='line'>
</span><span class='line'>解釋;
</span><span class='line'>CONFIG_LOCALVERSION_AUTO:                                                   │ 
</span><span class='line'>  │                                                                         │ 
</span><span class='line'>  │ This will try to automatically determine if the current tree is a       │ 
</span><span class='line'>  │ release tree by looking for git tags that belong to the current         │ 
</span><span class='line'>  │ top of tree revision.                                                   │ 
</span><span class='line'>  │                                                                         │ 
</span><span class='line'>  │ A string of the format -gxxxxxxxx will be added to the localversion     │ 
</span><span class='line'>  │ if a git-based tree is found.  The string generated by this will be     │ 
</span><span class='line'>  │ appended after any matching localversion* files, and after the value    │ 
</span><span class='line'>  │ set in CONFIG_LOCALVERSION.                                             │ 
</span><span class='line'>  │                                                                         │ 
</span><span class='line'>  │ (The actual string used here is the first eight characters produced     │ 
</span><span class='line'>  │ by running the command:                                                 │ 
</span><span class='line'>  │                                                                         │ 
</span><span class='line'>  │ which is done within the script "scripts/setlocalversion".)             │ 
</span><span class='line'>  │                                                                         │ 
</span><span class='line'>  │ Symbol: LOCALVERSION_AUTO [=y]                                          │ 
</span><span class='line'>  │ Prompt: Automatically append version information to the version string  │ 
</span><span class='line'>  │   Defined at init/Kconfig:84                                            │ 
</span><span class='line'>  │   Location:                                                             │ 
</span><span class='line'>  │ ingT
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;```&lt;/p&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[moto sbf包]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2014/12/22/android-sbf/"/&gt;
</span><span class='line'>&lt;updated&gt;2014-12-22T22:15:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2014/12/22/android-sbf&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;解出的CG35.smg或CG35.img是boot.img, boot.img可以按照 &lt;a href="/blog/2014/12/22/android-img/"&gt;这里&lt;/a&gt; 的方式编辑&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;span style="color:red"&gt;注意： motorola只有一些新的机型有方法解bootloader锁，沒解锁的bootloader会验证boot、recovery等分区的完整性（两个分区都是8M），不管有用的数据还是没用的数据都加入验证（好像是隔段距离取点数据做验证，因为替换最后100字节可以刷成功，替换多点就失败。可是实际有用的boot.img大小才4M左右）。&lt;/span&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;MOTO X解BL锁教程  &lt;a href="http://bbs.gfan.com/android-6726986-1-1.html"&gt;http://bbs.gfan.com/android-6726986-1-1.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;1 命令行解包&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;./sbf_flash -x OLYFR_U4_1.8.3_SIGNED_OLPSATTSPE_P013_HWolympus_1g_Service1FF.sbf
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;提取到一堆img文件&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;2神器：MotoAndroidDepacker&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;a href="http://www.veryhuo.com/down/html/47416.html"&gt;http://www.veryhuo.com/down/html/47416.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;就是这个软件，可以把moto的底包解开。&lt;br/&gt;
</span><span class='line'>使用很简单：&lt;br/&gt;
</span><span class='line'>1 点open from file菜单打开sbf底包，然后点split to files就解开了&lt;br/&gt;
</span><span class='line'>2 将要打包的文件拷到单独的文件夹A，然后点open files，选择刚刚的文件夹A，然后点compile file，就会在文件夹A里面生成result\firmware.sbf文件&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;解包出的文件解释：
</span><span class='line'>&lt;code&gt;
</span><span class='line'>CG31/CDT是描述各文件版本号的, 相当于注释文件
</span><span class='line'>CG33/CDROM是个ISO文件, 可以用WinRAR之类的打开, 包含PC端程序(MotoHelperAgent)
</span><span class='line'>CG35/Boot包含了系统内核&lt;-boot-only就是这个
</span><span class='line'>CG39/system分区
</span><span class='line'>CG40/cache缓存分区(国行多余的部分), 显然里面什么都没有
</span><span class='line'>CG45/Baseband基带固件
</span><span class='line'>CG47/Recovery就是官方恢复, 里面也包含独立的内核, 但不用于启动
</span><span class='line'>CG61/devtree包含设备描述符
</span><span class='line'>RAMDLD/RamDisk&amp;tmpfs, Android/Linux启动初始化的一部分, 不涉及具体设备
</span><span class='line'>&lt;/code&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;这篇感觉没用 &lt;a href="http://bbs.ihei5.com/thread-5883-1-1.html"&gt;http://bbs.ihei5.com/thread-5883-1-1.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[GT-S5830刷机教程]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2014/12/22/android-s5830-flash/"/&gt;
</span><span class='line'>&lt;updated&gt;2014-12-22T22:15:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2014/12/22/android-s5830-flash&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;h5&gt;ROM&lt;/h5&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;(推荐) 三星 S5830 2.3.4 ROM (国行ZCKPB) &lt;a href="http://dl.dbank.com/c0e5aato8l"&gt;http://dl.dbank.com/c0e5aato8l&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;2.3.6 ROM S5830DXKT7.tar.zip  &lt;a href="http://dl.vmall.com/c0016n1hza"&gt;http://dl.vmall.com/c0016n1hza&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h5&gt;工具&lt;/h5&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Odin Multi Downloader v4.38.exe &lt;a href="http://dl.dbank.com/c0ijy8bqrr"&gt;http://dl.dbank.com/c0ijy8bqrr&lt;/a&gt;
</span><span class='line'>记得装USB驱动&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h3&gt;教程&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;[贴自] &lt;a href="http://samsungbbs.cnmo.com/thread-10414540-1-1.html"&gt;http://samsungbbs.cnmo.com/thread-10414540-1-1.html&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;1&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;按HOME + 电源键进入recovery模式，双wipe&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;2&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;电源键+HOME键+音量调节下键 ， 两次出现三星log后会进入downloading模式&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;3&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;将手机与电脑通过USB数据线相连，然后运行刷机平台Odin Multi Downloader v4.38.exe&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-1.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;
</span><span class='line'>  CSC：全称Customer Specific Customization，里面包含的是运营商数据，不同ROM对应的区域不一样，所以CSC文件也不会相同。
</span><span class='line'>　　PDA：里面是CODE、ANDROID本身和所有的软件运行依靠的代码。
</span><span class='line'>　　PHONE：又称为MODEM，就是基带的意思，是所有通讯模块正常运行的依靠，机带情勿要随便升级替换。
</span><span class='line'>　　OPS：其实不是刷到手机中的文件，而是一个奥丁工具用来刷机的配置文件， 里面记录的是手机各个分区的信息。刷机的时候，奥丁依据这个配置将rom内的分区镜像恢复到指定分区中。如果勾选了“重新分区”，则依据这个配置重新分配分区。
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;4&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;选择对应的包&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-2.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;1、点击OPS命令按钮，浏览选择 Cooper_v1.0.ops    
</span><span class='line'>2、点击BOOT命令按钮，浏览选择 APBOOT_S5830****_CL382966_REV03_user_low_true.tar  
</span><span class='line'>3、点击Phone命令按钮，浏览选择 MODEM_S5830****_CL382966_REV03.tar  
</span><span class='line'>4、点击PDA命令按钮，浏览选择 CODE_S5830****_CL382966_REV03_user_low_true.tar  
</span><span class='line'>5、点击CSC命令按钮，浏览选 CSC_GT-S5830S5830O****_CL382966_REV03_user_low_true.tar  
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;span style="color:red"&gt;注意：可以只有OPS和PDA，PDA里面也可以只有boot.img。替换别的包刷的话最好保持原来包文件名的部分前缀，不然会提示“invalid image type”&lt;/span&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;独立包的刷包方式&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;因为独立包只有一个，看起来还是比较简单的。只用放一个包就好了。&lt;br/&gt;
</span><span class='line'>在刷之前确认格式是不是tar格式，名称里面有没有home。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-3.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;如果有在双击这个ROM，可以进入到压缩包里面，看到这些文件。基本上确认这个包可以刷了。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;OPS放好之后，看这里。这3个勾一定打上,&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-4.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;3个勾打上之后，就只有这里面才能放包了，其他都不行&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-5.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;刷好之后是这样&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;img src="/images/system/2014-12-22-6.jpg" alt="" /&gt;&lt;/p&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[samsung rfs、tar包]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2014/12/22/android-rfs-tar/"/&gt;
</span><span class='line'>&lt;updated&gt;2014-12-22T22:15:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2014/12/22/android-rfs-tar&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;boot.img可以按照 &lt;a href="/blog/2014/12/22/android-img/"&gt;这里&lt;/a&gt; 的方式编辑&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;GT-S5830分区
</span><span class='line'>&lt;code&gt;
</span><span class='line'>bml1 mibib
</span><span class='line'>bml2 qcsbl
</span><span class='line'>bml3 oemsbl
</span><span class='line'>bml4 amms
</span><span class='line'>bml5 ????????FSR_STL
</span><span class='line'>bml6 ????????FSR_STL / Empty|Empty RFS Partition???
</span><span class='line'>bml7 arm11boot
</span><span class='line'>bml8 Boot.img
</span><span class='line'>bml9 Recovery.img
</span><span class='line'>bml10 Looks like kernel init?????Contains this string:"em=330M console=NULL hw=5 fbaddr=0xb0000"
</span><span class='line'>bml11 Empty partion no partion table?? Whole file FF
</span><span class='line'>bml12 System.rfs
</span><span class='line'>bml13 Data Partition
</span><span class='line'>bml14 Cache Partition
</span><span class='line'>&lt;/code&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;把所有要打包进ROM的文件都复制到这个文件夹内；&lt;br/&gt;
</span><span class='line'>比如：这些刷机文件包括：boot.img
</span><span class='line'>&lt;code&gt;
</span><span class='line'>   $ tar -cf NewRom.tar boot.img
</span><span class='line'>   $ md5sum -t NewROM.tar &gt;&gt; NewROM.tar
</span><span class='line'>   $ mv NewROM.tar NewROM.tar.md5
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>第一句是TAR打包，第二句是md5签名，第三句是改文件名，可以省略。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;NewROM.tar.md5就是最后生成的，可供刷机用的ROM了！&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h4&gt;编辑 rfs&lt;/h4&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;挂载 RFS文件factoryfs.rfs 为一个磁盘：
</span><span class='line'>&lt;code&gt;
</span><span class='line'># su
</span><span class='line'># mount –o loop factoryfs.rfs System
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>进入“磁盘”System目录，你就可以看到factoryfs.rfs解包后的所有内容。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;修改好/System的内容后，在超级用户终端执行下面的语句卸载该“磁盘” ，这个操作等价于“打包”过程。
</span><span class='line'>&lt;code&gt;
</span><span class='line'># umount System
</span><span class='line'>&lt;/code&gt;&lt;/p&gt;
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>&lt;title type="html"&gt;&lt;![CDATA[查看所有(挂载、未挂载)的分区]]&gt;&lt;/title&gt;
</span><span class='line'>&lt;link href="http://abcdxyzk.github.io/blog/2014/12/22/android-partitions/"/&gt;
</span><span class='line'>&lt;updated&gt;2014-12-22T22:15:00+08:00&lt;/updated&gt;
</span><span class='line'>&lt;id&gt;http://abcdxyzk.github.io/blog/2014/12/22/android-partitions&lt;/id&gt;
</span><span class='line'>&lt;content type="html"&gt;&lt;![CDATA[&lt;p&gt;blog.chinaunix.net/uid-22731254-id-3222708.html&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;下面的例子都是围绕/system目录。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;使用df命令查看
</span><span class='line'>&lt;code&gt;
</span><span class='line'># df
</span><span class='line'>df
</span><span class='line'>Filesystem Size Used Free Blksize
</span><span class='line'>/dev       197M 64K   197M 4096
</span><span class='line'>/mnt/asec  197M 0K    197M 4096
</span><span class='line'>/mnt/obb   197M 0K    197M 4096
</span><span class='line'>/system    295M 245M  50M  4096
</span><span class='line'>/data      755M 26M   728M 4096
</span><span class='line'>/cache     188M 4M    184M 4096
</span><span class='line'>/HWUserData 2G 1024K  2G   32768
</span><span class='line'>/cust      59M 14M    44M  4096
</span><span class='line'>/mnt/sdcard 7G 753M   6G   32768
</span><span class='line'>/mnt/secure/asec 7G 753M 6G 32768
</span><span class='line'>&lt;/code&gt;
</span><span class='line'>看到/system分区有295MB的大小。&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;接着查看/proc下的partitions</span></code></pre></td></tr></table></div></figure>
    # cat /proc/partitions
    cat /proc/partitions
    major minor #blocks name</p>

<pre><code>179    0    3817472 mmcblk0
179    1    20      mmcblk0p1
179    2    300     mmcblk0p2
179    3    133120  mmcblk0p3
179    4    1       mmcblk0p4
179    5    12288   mmcblk0p5
179    6    196608  mmcblk0p6
179    7    4096    mmcblk0p7
179    8    3072    mmcblk0p8
179    9    4096    mmcblk0p9
179    10   3072    mmcblk0p10
179    11   3072    mmcblk0p11
179    12   393216  mmcblk0p12
179    13   786432  mmcblk0p13
179    14   4096    mmcblk0p14
179    15   8192    mmcblk0p15
179    16   20480   mmcblk0p16
179    17   4096    mmcblk0p17
179    18   81920   mmcblk0p18
179    19   2154496 mmcblk0p19
179    32   7761920 mmcblk1
179    33   7757824 mmcblk1p1
31     0    4096    mtdblock0
</code></pre>

<p>```</p>

<p>其实，可以在/proc/mounts下面看的更直接。。。</p>
]]></content>
  </entry>
  
</feed>

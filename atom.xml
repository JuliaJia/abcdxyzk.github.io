<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[kk Blog —— 通用基础]]></title>
  <link href="http://abcdxyzk.github.io/atom.xml" rel="self"/>
  <link href="http://abcdxyzk.github.io/"/>
  <updated>2014-12-09T00:57:01+08:00</updated>
  <id>http://abcdxyzk.github.io/</id>
  <author>
    <name><![CDATA[kk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Android模拟器]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/12/05/android-monitor/"/>
    <updated>2014-12-05T17:38:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/12/05/android-monitor</id>
    <content type="html"><![CDATA[<p>首先下载Android SDK ，完成安装openjdk-6-jre，还需要安装ia32-libs bison flex libglu1-mesa-dev 。<br/>
将下载回来的Android SDK解压缩后进入文件夹，运行tools/monitor<br/>
Window->Android SDK Manager 选择想要的模拟的android安转<br/>
Window->Android Virtual Device Manager 模拟器管理界面。</p>

<p>下载不了sdk就 <a href="https://awk.so/#newwindow=1&amp;q=dl-ssl.google.com+ip  ">https://awk.so/#newwindow=1&amp;q=dl-ssl.google.com+ip  </a>
搜索dl-ssl.google.com的IP，然后在hosts替换掉。如 203.208.46.200</p>

<h5>安装apk</h5>

<p>在电脑上运行 adb install /XXX/YYY.apk</p>

<p><a href="http://forum.ubuntu.org.cn/viewtopic.php?t=311659">android虚拟机QQ</a></p>

<p><a href="http://www.findspace.name/easycoding/415">http://www.findspace.name/easycoding/415</a></p>

<h5>中文输入法</h5>

<p>要到设置->语言和输入法中勾选选择输入，再点击输入法靠右的地方进行设置。</p>

<p><a href="http://segmentfault.com/blog/cherishsir/1190000000686224">ubuntu下,使用chrome 浏览器运行安卓apk程序</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用usb进行调试]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/12/04/android-usb-debug/"/>
    <updated>2014-12-04T18:05:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/12/04/android-usb-debug</id>
    <content type="html"><![CDATA[<h4>一 下载</h4>

<p>下载 platform-tools 或 adt-bundle-linux-x86_64-XXX.zip（这个很大）</p>

<h4>二 连接</h4>

<p>adb start-server 打开服务<br/>
如果一切正常的话<br/>
输入<br/>
adb devices<br/>
就能显示出当前连接到电脑的android设备 ^_^<br/>
试试这个命令<br/>
adb shell<br/>
就能在Ubuntu上的终端执行android的shell命令了<br/>
su<br/>
切换到root</p>

<p>或者</p>

<p>adb root<br/>
再<br/>
adb shell<br/>
不过这种不一定成功</p>

<h4>三 不能执行的sdcard分区如下</h4>

<p>$ mount</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/dev/block/vold/93:80 /mnt/sdcard vfat rw,dirsync,nosuid,nodev,noexec,relatime,uid=1000,gid=1015,fmask=0702,dmask=0702,allow_utime=0020,codepage=cp437,iocharset=ascii,shortname=mixed,utf8,errors=remount-ro 0 0</span></code></pre></td></tr></table></div></figure>


<p>我用的平台，默认加载sdcard分区是noexec，所以无法执行该分区下的文件。</p>

<p>重新加载该分区mount -o rw,remount /mnt/sdcard</p>

<p>然后一切正常，自己的执行程序现在工作正常了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[编译Android的kernel]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/12/04/compiler-android-kernel/"/>
    <updated>2014-12-04T17:34:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/12/04/compiler-android-kernel</id>
    <content type="html"><![CDATA[<h4>一 下载</h4>

<ol>
<li><p>下载arm编译器<br/>
<a href="https://launchpad.net/gcc-arm-embedded/+download">https://launchpad.net/gcc-arm-embedded/+download</a></p></li>
<li><p>进入到你的android源代码目录，敲入下面命令：<br/>
git clone <a href="http://android.googlesource.com/kernel/goldfish.git">http://android.googlesource.com/kernel/goldfish.git</a> kernel</p></li>
<li><p>cd kernel  进入我们刚才创建的kernel文件夹</p></li>
<li><p>git branch -avv 查看远程的git 库<br/>
我们选择remotes/origin/android-goldfish-2.6.29分支来下载</p></li>
<li><p>git checkout -b android-goldfish-2.6.29 remotes/origin/android-goldfish-2.6.29</p></li>
</ol>


<h4>二  编译kernel代码</h4>

<ol>
<li><p>设置环境变量<br/>
export PATH=$PATH:~/andr-perf/gcc-arm-none-eabi-4_8-2014q3/bin</p></li>
<li><p>修改kernel下面的makefile文件，修改<br/>
ARCH        ?= $(SUBARCH)<br/>
CROSS_COMPILE    ?=<br/>
这两个字段成如下内容：<br/>
ARCH        ?= arm<br/>
CROSS_COMPILE    ?= arm-none-eabi-</p></li>
<li><p>开始编译,敲入如下命令<br/>
make goldfish_defconfig<br/>
或者看arch/arm/configs/目录下有什么，就挑一个make XXX</p></li>
<li><p>正式编译,敲入如下命令<br/>
make</p></li>
</ol>


<p>正式编译成功之后，我们会看到如下文字：<br/>
OBJCOPY arch/arm/boot/zImage<br/>
Kernel: arch/arm/boot/zImage is ready</p>

<h4>三  利用新编译的kernel来启动模拟器</h4>

<ol>
<li><p>在启动模拟器之前，先设置模拟器的目录到环境变量$PATH中去：<br/>
  USER-NAME@MACHINE-NAME:~/Android$ export PATH=$PATH:~/android_prj/out/host/linux-x86/bin</p></li>
<li><p>设置ANDROID_PRODUCT_OUT环境变量：<br/>
USER-NAME@MACHINE-NAME:~/Android$ export ANDROID_PRODUCT_OUT=~/android_prj/out/target/product/generic<br/>
同样，如果你的源代码目录不是android_prj，请注意修改下。另外，如果你已经配置了环境变量。则不必如此。建议最好写到配置文件 ~/.bash_rc配置文件里面去。 免得每次都要配置</p></li>
<li><p>启动模拟器<br/>
cd ~/android_prj  回到源代码目录<br/>
sandy@ubuntu:~/android_prj$ emulator -kernel ./kernel/arch/arm/boot/zImage 利用刚才我们编译的kernel内核启动模拟器</p></li>
<li><p>验证结果<br/>
待模拟器启动完毕之后，我们敲入adb shell<br/>
第一次会说device offline，不管它，再敲入一遍，就会进入adb 调试<br/>
然后cd proc 进入proc目录，cat version</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[部分GCC选项]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/12/04/compiler-gcc-args/"/>
    <updated>2014-12-04T17:23:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/12/04/compiler-gcc-args</id>
    <content type="html"><![CDATA[<h5>-Werror 和 -I 很有用</h5>

<table>
<tr bgcolor="#c0c0c0">
<th>命令</th><th>描述</th>
</tr>
<tr>
<td>-l&nbsp;<em>library</em>-l<em>library</em></td>
<td>进行链接时搜索名为library的库。例子： $ gcc test.c -lm -o test</td>
</tr>
<tr>
<td>-I<em>dir</em></td>
<td>把<em>dir</em>加入到搜索头文件的路径列表中。例子： $ gcc test.c -I../inc -o test</td>
</tr>
<tr>
<td>-L<em>dir</em></td>
<td>把<em>dir</em>加入到搜索库文件的路径列表中。例子： $ gcc -I/home/foo -L/home/foo -ltest test.c -o test</td>
</tr>
<tr>
<td>-D<em>name</em></td>
<td>预定义一个名为<em>name</em>的宏，值为1。例子： $ gcc -DTEST_CONFIG test.c -o test</td>
</tr>
<tr>
<td>-D<em>name</em>=<em>definition</em></td>
<td>预定义名为<em>name</em>，值为<em>definition</em>的宏。</td>
</tr>
<tr>
<td>-ggdb&nbsp;-ggdb<em>level</em></td>
<td>为调试器 gdb 生成调试信息。<em>level</em>可以为1，2，3，默认值为2。</td>
</tr>
<tr>
<td>-g&nbsp;-g<em>level</em></td>
<td>生成操作系统本地格式的调试信息。-g 和 -ggdb 并不太相同， -g 会生成 gdb 之外的信息。<em>level</em>取值同上。</td>
</tr>
<tr>
<td>-s</td>
<td>去除可执行文件中的符号表和重定位信息。用于减小可执行文件的大小。</td>
</tr>
<tr>
<td>-M</td>
<td>告诉预处理器输出一个适合make的规则，用于描述各目标文件的依赖关系。对于每个 源文件，预处理器输出 一个make规则，该规则的目标项(target)是源文件对应的目标文件名，依赖项(dependency)是源文件中 #include引用的所有文件。生成的规则可 以是单行，但如果太长，就用`/'-换行符续成多行。规则 显示在标准输出，不产生预处理过的C程序。</td>
</tr>
<tr>
<td>-C</td>
<td>告诉预处理器不要丢弃注释。配合`-E'选项使用。</td>
</tr>
<tr>
<td>-P</td>
<td>告诉预处理器不要产生`#line'命令。配合`-E'选项使用。</td>
</tr>
<tr>
<td>-static</td>
<td>在支持动态链接的系统上，阻止连接共享库。该选项在其它系统上 无效。</td>
</tr>
<tr>
<td>-nostdlib</td>
<td>不连接系统标准启动文件和标准库文件，只把指定的文件传递给连接器。</td>
</tr>
<tr bgcolor="#c0c0c0">
<th>Warnings</th><th></th>
</tr>
<tr>
<td>-Wall</td>
<td>会打开一些很有用的警告选项，建议编译时加此选项。</td>
</tr>
<tr>
<td>-W&nbsp;-Wextra</td>
<td>打印一些额外的警告信息。</td>
</tr>
<tr>
<td>-w</td>
<td>禁止显示所有警告信息。</td>
</tr>
<tr>
<td>-Wshadow</td>
<td>当一个局部变量遮盖住了另一个局部变量，或者全局变量时，给出警告。很有用的选项，建议打开。 -Wall 并不会打开此项。</td>
</tr>
<tr>
<td>-Wpointer-arith</td>
<td>对函数指针或者void *类型的指针进行算术操作时给出警告。也很有用。 -Wall 并不会打开此项。</td>
</tr>
<tr>
<td>-Wcast-qual</td>
<td>当强制转化丢掉了类型修饰符时给出警告。 -Wall 并不会打开此项。</td>
</tr>
<tr>
<td>-Waggregate-return</td>
<td>如果定义或调用了返回结构体或联合体的函数，编译器就发出警告。</td>
</tr>
<tr>
<td>-Winline</td>
<td>无论是声明为 inline 或者是指定了-finline-functions 选项，如果某函数不能内联，编译器都将发出警告。如果你的代码含有很多 inline 函数的话，这是很有用的选项。</td>
</tr>
<tr>
<td>-Werror</td>
<td>把警告当作错误。出现任何警告就放弃编译。</td>
</tr>
<tr>
<td>-Wunreachable-code</td>
<td>如果编译器探测到永远不会执行到的代码，就给出警告。也是比较有用的选项。</td>
</tr>
<tr>
<td>-Wcast-align</td>
<td>一旦某个指针类型强制转换导致目标所需的地址对齐增加时，编译器就发出警告。</td>
</tr>
<tr>
<td>-Wundef</td>
<td>当一个没有定义的符号出现在 #if 中时，给出警告。</td>
</tr>
<tr>
<td>-Wredundant-decls</td>
<td>如果在同一个可见域内某定义多次声明，编译器就发出警告，即使这些重复声明有效并且毫无差别。</td>
</tr>
</table>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[正则表达式常用字符]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/27/tools-reg-exp-base/"/>
    <updated>2014-11-27T19:05:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/27/tools-reg-exp-base</id>
    <content type="html"><![CDATA[<table>
    <tr>
        <td style="text-align: center;">字符</td>
        <td style="text-align: center;">描述</td>
    </tr>
    <tr>
        <td style="text-align: center;">\</td>
        <td>将下一个字符标记为一个特殊字符、或一个原义字符、或一个 后向引用、或一个八进制转义符。例如，'n' 匹配字符 "n"。'\n' 匹配一个换行符。序列 '\\' 匹配 "\" 而 "\(" 则匹配 "("。</td>
    </tr>
    <tr>
        <td style="text-align: center;">^</td>
        <td>匹配输入字符串的开始位置。如果设置了&nbsp;<strong>RegExp</strong>&nbsp;对象的&nbsp;<strong>Multiline</strong>&nbsp;属性，^ 也匹配 '\n' 或 '\r' 之后的位置。</td>
    </tr>
    <tr>
        <td style="text-align: center;">$</td>
        <td>匹配输入字符串的结束位置。如果设置了<strong>RegExp</strong>&nbsp;对象的&nbsp;<strong>Multiline</strong>&nbsp;属性，$ 也匹配 '\n' 或 '\r' 之前的位置。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\A</td>
        <td>指定匹配必须出现在字符串的开头（忽略 &nbsp; <strong>Multiline</strong> &nbsp; 选项）。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\Z</td>
        <td>指定匹配必须出现在字符串的结尾或字符串结尾的 &nbsp; &nbsp; 之前（忽略 &nbsp; <strong>Multiline</strong> &nbsp; 选项）。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\z</td>
        <td>指定匹配必须出现在字符串的结尾（忽略 &nbsp; <strong>Multiline</strong> &nbsp; 选项）。</td>
    </tr>
    <tr>
        <td style="text-align: center;">*</td>
        <td>匹配前面的子表达式零次或多次。例如，zo* 能匹配 "z" 以及 "zoo"。 * 等价于{0,}。</td>
    </tr>
    <tr>
        <td style="text-align: center;">+</td>
        <td>匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 "zo" 以及 "zoo"，但不能匹配 "z"。+ 等价于 {1,}。</td>
    </tr>
    <tr>
        <td style="text-align: center;">?</td>
        <td>匹配前面的子表达式零次或一次。例如，"do(es)?" 可以匹配 "do" 或 "does" 中的"do" 。? 等价于 {0,1}。</td>
    </tr>
    <tr>
        <td style="text-align: center;">{<em>n</em>}</td>
        <td><em>n</em>&nbsp;是一个非负整数。匹配确定的&nbsp;<em>n</em>&nbsp;次。例如，'o{2}' 不能匹配 "Bob" 中的 'o'，但是能匹配 "food" 中的两个 o。</td>
    </tr>
    <tr>
        <td style="text-align: center;">{<em>n</em>,}</td>
        <td><em>n</em>&nbsp;是一个非负整数。至少匹配<em>n</em>&nbsp;次。例如，'o{2,}' 不能匹配 "Bob" 中的 'o'，但能匹配 "foooood" 中的所有 o。'o{1,}' 等价于 'o+'。'o{0,}' 则等价于 'o*'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">{<em>n</em>,<em>m</em>}</td>
        <td><em>m</em>&nbsp;和&nbsp;<em>n</em>&nbsp;均为非负整数，其中<em>n</em>&nbsp;&lt;=&nbsp;<em>m</em>。最少匹配&nbsp;<em>n</em>&nbsp;次且最多匹配&nbsp;<em>m</em>&nbsp;次。刘， "o{1,3}" 将匹配 "fooooood" 中的前三个 o。'o{0,1}' 等价于 'o?'。请注意在逗号和两个数之间不能有空格。</td>
    </tr>
    <tr>
        <td style="text-align: center;">?</td>
        <td>当该字符紧跟在任何一个其他限制符 (*, +, ?, {<em>n</em>}, {<em>n</em>,}, {<em>n</em>,<em>m</em>}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 "oooo"，'o+?' 将匹配单个 "o"，而 'o+' 将匹配所有 'o'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">.</td>
        <td>匹配除 "\n" 之外的任何单个字符。要匹配包括 '\n' 在内的任何字符，请使用象 '[.\n]' 的模式。</td>
    </tr>
    <tr>
        <td style="text-align: center;">(<em>pattern</em>)</td>
        <td>匹配<em>pattern</em>&nbsp;并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用&nbsp;<strong>SubMatches</strong>&nbsp;集合，在Visual Basic Scripting Edition 中则使用&nbsp;<strong>$0</strong>…<strong>$9</strong>&nbsp;属性。要匹配圆括号字符，请使用 '\(' 或 '\)'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">(?:<em>pattern</em>)</td>
        <td>匹配&nbsp;<em>pattern</em>&nbsp;但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 "或" 字符 (|) 来组合一个模式的各个部分是很有用。例如， 'industr(?:y|ies) 就是一个比 'industry|industries' 更简略的表达式。</td>
    </tr>
    <tr>
        <td style="text-align: center;">(?=<em>pattern</em>)</td>
        <td>正向预查，在任何匹配&nbsp;<em>pattern</em>&nbsp;的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如， 'Windows (?=95|98|NT|2000)' 能匹配 "Windows 2000" 中的 "Windows" ，但不能匹配 "Windows 3.1" 中的 "Windows"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td>
    </tr>
    <tr>
        <td style="text-align: center;">(?!<em>pattern</em>)</td>
        <td>负向预查，在任何不匹配Negative lookahead matches the search string at any point where a string not matching&nbsp;<em>pattern</em>&nbsp;的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如'Windows (?!95|98|NT|2000)' 能匹配 "Windows 3.1" 中的 "Windows"，但不能匹配 "Windows 2000" 中的 "Windows"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始</td>
    </tr>
    <tr>
        <td style="text-align: center;"><em>x</em>|<em>y</em></td>
        <td>匹配&nbsp;<em>x</em>&nbsp;或&nbsp;<em>y</em>。例如，'z|food' 能匹配 "z" 或 "food"。'(z|f)ood' 则匹配 "zood" 或 "food"。</td>
    </tr>
    <tr>
        <td style="text-align: center;">[<em>xyz</em>]</td>
        <td>字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 "plain" 中的 'a'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">[^<em>xyz</em>]</td>
        <td>负值字符集合。匹配未包含的任意字符。例如， '[^abc]' 可以匹配 "plain" 中的'p'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">[<em>a-z</em>]</td>
        <td>字符范围。匹配指定范围内的任意字符。例如，'[a-z]' 可以匹配 'a' 到 'z' 范围内的任意小写字母字符。</td>
    </tr>
    <tr>
        <td style="text-align: center;">[^<em>a-z</em>]</td>
        <td>负值字符范围。匹配任何不在指定范围内的任意字符。例如，'[^a-z]' 可以匹配任何不在 'a' 到 'z' 范围内的任意字符。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\b</td>
        <td>匹配一个单词边界，也就是指单词和空格间的位置。例如， 'er\b' 可以匹配"never" 中的 'er'，但不能匹配 "verb" 中的 'er'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\B</td>
        <td>匹配非单词边界。'er\B' 能匹配 "verb" 中的 'er'，但不能匹配 "never" 中的 'er'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\c<em>x</em></td>
        <td>匹配由<em>x</em>指明的控制字符。例如， \cM 匹配一个 Control-M 或回车符。&nbsp;<em>x</em>&nbsp;的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\d</td>
        <td>匹配一个数字字符。等价于 [0-9]。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\D</td>
        <td>匹配一个非数字字符。等价于 [^0-9]。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\f</td>
        <td>匹配一个换页符。等价于 \x0c 和 \cL。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\n</td>
        <td>匹配一个换行符。等价于 \x0a 和 \cJ。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\r</td>
        <td>匹配一个回车符。等价于 \x0d 和 \cM。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\s</td>
        <td>匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [&nbsp;\f\n\r\t\v]。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\S</td>
        <td>匹配任何非空白字符。等价于 [^&nbsp;\f\n\r\t\v]。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\t</td>
        <td>匹配一个制表符。等价于 \x09 和 \cI。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\v</td>
        <td>匹配一个垂直制表符。等价于 \x0b 和 \cK。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\w</td>
        <td>匹配包括下划线的任何单词字符。等价于'[A-Za-z0-9_]'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\W</td>
        <td>匹配任何非单词字符。等价于 '[^A-Za-z0-9_]'。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\x<em>n</em></td>
        <td>匹配&nbsp;<em>n</em>，其中&nbsp;<em>n</em>&nbsp;为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如， '\x41' 匹配 "A"。'\x041' 则等价于 '\x04' &amp; "1"。正则表达式中可以使用 ASCII 编码。.</td>
    </tr>
    <tr>
        <td style="text-align: center;">\<em>num</em></td>
        <td>匹配&nbsp;<em>num</em>，其中&nbsp;<em>num</em>&nbsp;是一个正整数。对所获取的匹配的引用。例如，'(.)\1' 匹配两个连续的相同字符。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\<em>n</em></td>
        <td>标识一个八进制转义值或一个后向引用。如果 \<em>n</em>&nbsp;之前至少&nbsp;<em>n</em>&nbsp;个获取的子表达式，则&nbsp;<em>n</em>&nbsp;为后向引用。否则，如果&nbsp;<em>n</em>&nbsp;为八进制数字 (0-7)，则&nbsp;<em>n</em>&nbsp;为一个八进制转义值。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\<em>nm</em></td>
        <td>标识一个八进制转义值或一个后向引用。如果 \<em>nm</em>&nbsp;之前至少有is preceded by at least&nbsp;<em>nm</em>&nbsp;个获取得子表达式，则&nbsp;<em>nm</em>&nbsp;为后向引用。如果 \<em>nm</em>&nbsp;之前至少有&nbsp;<em>n</em>&nbsp;个获取，则&nbsp;<em>n</em>&nbsp;为一个后跟文字&nbsp;<em>m&nbsp;</em>的后向引用。如果前面的条件都不满足，若&nbsp;&nbsp;<em>n</em>&nbsp;和&nbsp;<em>m</em>&nbsp;均为八进制数字 (0-7)，则 \<em>nm</em>&nbsp;将匹配八进制转义值&nbsp;<em>nm</em>。</td>
    </tr>
    <tr>
        <td style="text-align: center;">\<em>nml</em></td>
        <td>如果&nbsp;<em>n</em>&nbsp;为八进制数字 (0-3)，且&nbsp;<em>m</em>&nbsp;和&nbsp;<em>l</em>&nbsp;均为八进制数字 (0-7)，则匹配八进制转义值&nbsp;<em>nml。</em></td>
    </tr>
    <tr>
        <td style="text-align: center;">\u<em>n</em></td>
        <td>匹配&nbsp;<em>n</em>，其中&nbsp;<em>n</em>&nbsp;是一个用四个十六进制数字表示的 Unicode 字符。例如， \u00A9 匹配版权符号 (?)。</td>
    </tr>
</table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jekyll的一些全局变量]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/27/blog-octopress-jekyll/"/>
    <updated>2014-11-27T13:30:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/27/blog-octopress-jekyll</id>
    <content type="html"><![CDATA[<p><a href="http://jekyllrb.com/docs/variables/">http://jekyllrb.com/docs/variables/</a><br/>
octopress是基于jekyll，所以也可以用这些内容</p>

<h4>Variables</h4>

<p>Jekyll traverses your site looking for files to process. Any files with YAML front matter are subject to processing. For each of these files, Jekyll makes a variety of data available via the Liquid templating system. The following is a reference of the available data.</p>

<h5>Global Variables</h5>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>site</p></td>
      <td><p>
          Sitewide information + configuration settings from
          _config.yml. See below for details.
      </p></td>
    </tr>
    <tr>
      <td><p>page</p></td>
      <td><p>
        Page specific information + the <a href="../frontmatter/">YAML front
        matter</a>. Custom variables set via the YAML Front Matter will be
        available here. See below for details.
      </p></td>
    </tr>
    <tr>
      <td><p>content</p></td>
      <td><p>
        In layout files, the rendered content of the Post or Page being wrapped.
        Not defined in Post or Page files.
      </p></td>
    </tr>
    <tr>
      <td><p>paginator</p></td>
      <td><p>
        When the paginate configuration option is set, this
        variable becomes available for use. 
      </p></td>
    </tr>
  </tbody>
</table>


<h5>Site Variables</h5>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>site.time</p></td>
      <td><p>
        The current time (when you run the jekyll command).
      </p></td>
    </tr>
    <tr>
      <td><p>site.pages</p></td>
      <td><p>
        A list of all Pages.
      </p></td>
    </tr>
    <tr>
      <td><p>site.posts</p></td>
      <td><p>
        A reverse chronological list of all Posts.
      </p></td>
    </tr>
    <tr>
      <td><p>site.related_posts</p></td>
      <td><p>
        If the page being processed is a Post, this contains a list of up to ten
        related Posts. By default, these are low quality but fast to compute.
        For high quality but slow to compute results, run the
        jekyll command with the --lsi (latent semantic
        indexing) option.
      </p></td>
    </tr>
    <tr>
      <td><p>site.static_files</p></td>
      <td><p>
        A list of all static files (i.e. files not processed by Jekyll's
        converters or the Liquid renderer). Each file has three properties:
        path, modified_time and extname.
      </p></td>
    </tr>
    <tr>
      <td><p>site.html_pages</p></td>
      <td><p>
        A list of all HTML Pages.
      </p></td>
    </tr>
    <tr>
      <td><p>site.collections</p></td>
      <td><p>
        A list of all the collections.
      </p></td>
    </tr>
    <tr>
      <td><p>site.data</p></td>
      <td><p>
        A list containing the data loaded from the YAML files located in the _data directory.
      </p></td>
    </tr>
    <tr>
      <td><p>site.documents</p></td>
      <td><p>
        A list of all the documents in every collection.
      </p></td>
    </tr>
    <tr>
      <td><p>site.categories.CATEGORY</p></td>
      <td><p>
        The list of all Posts in category CATEGORY.
      </p></td>
    </tr>
    <tr>
      <td><p>site.tags.TAG</p></td>
      <td><p>
        The list of all Posts with tag TAG.
      </p></td>
    </tr>
    <tr>
      <td><p>site.[CONFIGURATION_DATA]</p></td>
      <td><p>
        All the variables set via the command line and your
        _config.yml are available through the site
        variable. For example, if you have url: http://mysite.com
        in your configuration file, then in your Posts and Pages it will be
        stored in site.url. Jekyll does not parse changes to
        _config.yml in watch mode, you must restart
        Jekyll to see changes to variables.
      </p></td>
    </tr>
  </tbody>
</table>


<h5>Page Variables</h5>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>page.content</p></td>
      <td><p>
        The content of the Page, rendered or un-rendered depending upon
        what Liquid is being processed and what page is.
      </p></td>
    </tr>
    <tr>
      <td><p>page.title</p></td>
      <td><p>
        The title of the Page.
      </p></td>
    </tr>
    <tr>
      <td><p>page.excerpt</p></td>
      <td><p>
        The un-rendered excerpt of the Page.
      </p></td>
    </tr>
    <tr>
      <td><p>page.url</p></td>
      <td><p>
        The URL of the Post without the domain, but
        with a leading slash, e.g.
        /2008/12/14/my-post.html
      </p></td>
    </tr>
    <tr>
      <td><p>page.date</p></td>
      <td><p>
        The Date assigned to the Post. This can be overridden in a Post’s front
        matter by specifying a new date/time in the format
        YYYY-MM-DD HH:MM:SS (assuming UTC), or
        YYYY-MM-DD HH:MM:SS +/-TTTT (to specify a time zone using
        an offset from UTC. e.g. 2008-12-14 10:30:00 +0900).
      </p></td>
    </tr>
    <tr>
      <td><p>page.id</p></td>
      <td><p>
        An identifier unique to the Post (useful in RSS feeds). e.g.
        /2008/12/14/my-post
      </p></td>
    </tr>
    <tr>
      <td><p>page.categories</p></td>
      <td><p>
        The list of categories to which this post belongs. Categories are
        derived from the directory structure above the _posts
        directory. For example, a post at
        /work/code/_posts/2008-12-24-closures.md would have this
        field set to ['work', 'code']. These can also be specified
        in the <a href="../frontmatter/">YAML Front Matter</a>.
      </p></td>
    </tr>
    <tr>
      <td><p>page.tags</p></td>
      <td><p>
        The list of tags to which this post belongs. These can be specified in
        the <a href="../frontmatter/">YAML Front Matter</a>.
      </p></td>
    </tr>
    <tr>
      <td><p>page.path</p></td>
      <td><p>
        The path to the raw post or page. Example usage: Linking back to the
        page or post’s source on GitHub. This can be overridden in the
        <a href="../frontmatter/">YAML Front Matter</a>.
      </p></td>
    </tr>
    <tr>
      <td><p>page.next</p></td>
      <td><p>
        The next post relative to the position of the current post in
        site.posts. Returns nil for the last entry.
      </p></td>
    </tr>
    <tr>
      <td><p>page.previous</p></td>
      <td><p>
        The previous post relative to the position of the current post in
        site.posts. Returns nil for the first entry.
      </p></td>
    </tr>
  </tbody>
</table>


<h5>Paginator</h5>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>paginator.per_page</p></td>
      <td><p>Number of Posts per page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.posts</p></td>
      <td><p>Posts available for that page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.total_posts</p></td>
      <td><p>Total number of Posts.</p></td>
    </tr>
    <tr>
      <td><p>paginator.total_pages</p></td>
      <td><p>Total number of Pages.</p></td>
    </tr>
    <tr>
      <td><p>paginator.page</p></td>
      <td><p>The number of the current page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.previous_page</p></td>
      <td><p>The number of the previous page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.previous_page_path</p></td>
      <td><p>The path to the previous page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.next_page</p></td>
      <td><p>The number of the next page.</p></td>
    </tr>
    <tr>
      <td><p>paginator.next_page_path</p></td>
      <td><p>The path to the next page.</p></td>
    </tr>
  </tbody>
</table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress优化]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/25/octopress-5/"/>
    <updated>2014-11-25T23:34:33+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/25/octopress-5</id>
    <content type="html"><![CDATA[<h4>octopress优化</h4>

<p>能够让octopress在50篇文章下跑进5s，不优化要跑60s左右</p>

<h5>运行过程</h5>

<p>看octopress目录下的Rakefile，里面有generate，preview，watch等。<br/>
输入rake generate是就是按照Rakefile中<code>task :generate do</code>执行的。<br/>
最主要的两条：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>system "compass compile --css-dir #{source_dir}/stylesheets"
</span><span class='line'>system "jekyll build"</span></code></pre></td></tr></table></div></figure>


<p>第一条是编译css，第二条是生成文章。</p>

<!--more-->


<p>第一条不知道如何优化，略过。<br/>
第二条接着执行到<br/>
/usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/commands/build.rb<br/>
文件的init_with_program -> process -> build然后到<br/>
/usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/command.rb文件的process_site然后到<br/>
/usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb文件的process，<br/>
process代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>47     def process
</span><span class='line'>48       reset
</span><span class='line'>49       read
</span><span class='line'>50       generate
</span><span class='line'>51       render
</span><span class='line'>52       cleanup
</span><span class='line'>53       write
</span><span class='line'>54     end</span></code></pre></td></tr></table></div></figure>


<p>这里的函数都在这个文件里，主要费时在generate和render。</p>

<h6>1. generate</h6>

<p>generate会执行octopress/plugins目录下的tag_generator.rb和category_generator.rb，<br/>
这两个文件的write_tag_indexes和write_category_indexes分别回构建tag和category的分类首页。<br/>
所以tag和category越多构建越慢。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from /home/kk/kk/github/octopress/plugins/rubypants.rb:261:in `to_html'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/octopress_filters.rb:31:in `post_filter'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/octopress_filters.rb:41:in `post_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:255:in `block in post_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:254:in `each'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:254:in `post_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:224:in `do_layout'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/page.rb:122:in `render'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/category_generator.rb:100:in `write_category_index'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/category_generator.rb:112:in `block in write_category_indexes'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/category_generator.rb:111:in `each'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/category_generator.rb:111:in `write_category_indexes'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/category_generator.rb:141:in `generate'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:280:in `block in generate'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:279:in `each'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:279:in `generate'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:50:in `process'</span></code></pre></td></tr></table></div></figure>


<h6>2. render</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from /home/kk/kk/github/octopress/plugins/rubypants.rb:261:in `to_html'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/octopress_filters.rb:31:in `post_filter'
</span><span class='line'>from /home/kk/kk/github/octopress/plugins/octopress_filters.rb:41:in `post_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:249:in `block in pre_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:248:in `each'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:248:in `pre_render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/octopress-hooks-2.2.1/lib/octopress-hooks.rb:222:in `do_layout'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/page.rb:122:in `render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:299:in `block in render'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:298:in `each'
</span><span class='line'>from /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb:298:in `render'</span></code></pre></td></tr></table></div></figure>


<p>都是慢在octopress/plugins/rubypants.rb的to_html函数。</p>

<h5>优化</h5>

<h6>1、to_html函数的tokenize和gsub很慢。</h6>

<p>to_html函数只是把一些' &ldquo;之类的转成html，试了一下不执行to_html，diff出来差别不大，页面上显示也都还OK。单纯的&lt;在其他地方已经转好了。<br/>
所以octopress/plugins/octopress_filters.rb中不执行to_html</p>

<h6>2、每次计算侧边栏太慢</h6>

<p>所有页面都是按照其layout的格式找对应source/_layout/下的模板来生成的。<br/>
注意post.html和page.html的最后都有 <code>{ { include_array XXX } }</code>, 这就是说每个页面都要运行plugins/include_array.rb中的render(context)来生成侧边栏。<br/>
但是侧边栏应该是(?)都一样的。所以改成隔一定时间计算一次</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> 26     @@caltime = 0
</span><span class='line'> 27     @@retstore = ""
</span><span class='line'> 28     def render(context)
</span><span class='line'> 29         if Time.now.to_f - @@caltime &lt; context.registers[:site].config['recaltime']
</span><span class='line'> 30                 return @@retstore;
</span><span class='line'> 31         end
</span><span class='line'> 32         @@caltime = Time.now.to_f
</span><span class='line'>...
</span><span class='line'> 58       @@retstore = rtn</span></code></pre></td></tr></table></div></figure>


<p>为什么要隔一段时间？因为在preview中有改动任何文件就会重新生成一次，这时侧边栏也要重新计算</p>

<h6>3、减小文件大小</h6>

<p>我的侧边栏有二级目录，整个侧边栏比较大，50篇时已经有20k。所以将侧边栏独立成一个文件，用js来load。<br/>
plugins/include_array.rb中加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>59       fp = File.new('sidebar.html', 'w');
</span><span class='line'>60       fp.puts(rtn);
</span><span class='line'>61       fp.puts('&lt;script src="http://abcdxyzk.github.io/javascripts/category.js" type="text/javascript"&gt;&lt;/script&gt;');
</span><span class='line'>62       fp.puts('&lt;script type="text/javascript"&gt; hadOpenDiv();&lt;/script&gt;');
</span><span class='line'>63       fp.close();</span></code></pre></td></tr></table></div></figure>


<p>source/<em>layout/post.html和source/</em>layout/page.html的最后部分改成：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>35 &lt;aside class="sidebar" id='load_sidebar'&gt;
</span><span class='line'>36 &lt;/aside&gt;
</span><span class='line'>37 &lt;script type="text/javascript"&gt;
</span><span class='line'>38   $('#load_sidebar').load('/sidebar.html');
</span><span class='line'>39 &lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>因为source/index.html里也有 <code>{ { include_array XXX } }</code>，所以不用担心不执行plugins/include_array.rb。<br/>
问题1：就是"最近评论"要从_config.yml中的default_asides:中移到source/index.html中。因为js load进的文件中的document.write不执行了。这也就是为什么source/index.html不采用js load。如果是<code>&lt;aside&gt;</code>中增加div用来load的话，侧边栏缩到底部就没有三列的效果。<br/>
问题2：sidebar.html要写到主目录，source/sidebar.html中用ln软链接到sidebar.html。因为如果在watch状态直接写到source/目录的话，他就会再次认为文件有改变，又重新生成。造成在不断生成的死循环。细节是在Rakefile文件的generate和preview中先加软链接再运行其他</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>56 task :generate do
</span><span class='line'>57   system('&gt;`pwd`/sidebar.html')
</span><span class='line'>58   system('ln -f -s `pwd`/sidebar.html `pwd`/source/sidebar.html')</span></code></pre></td></tr></table></div></figure>


<h5>优化效果</h5>

<p>在文件中加入时间输出代码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>p "    #{ __FILE__} line:#{__LINE__} time:#{Time.now.to_f}"</span></code></pre></td></tr></table></div></figure>


<p>50篇文章，40个tag，61个category，运行如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kk@kk-laptop:~/kk/github/octopress(source)$ rake generate
</span><span class='line'>## Generating Site with Jekyll
</span><span class='line'>"/home/kk/kk/github/octopress/Rakefile line:62 time:1416933869.1204205"
</span><span class='line'>identical source/stylesheets/screen.css 
</span><span class='line'>"/home/kk/kk/github/octopress/Rakefile line:64 time:1416933870.019113"
</span><span class='line'>Configuration file: /home/kk/kk/github/octopress/_config.yml
</span><span class='line'>            Source: source
</span><span class='line'>       Destination: public
</span><span class='line'>      Generating... 
</span><span class='line'>"    /home/kk/kk/github/octopress/plugins/category_generator.rb line:110 time:1416933870.7509217"
</span><span class='line'>"    /home/kk/kk/github/octopress/plugins/category_generator.rb line:114 time:1416933871.8838022"
</span><span class='line'>"    /home/kk/kk/github/octopress/plugins/tag_generator.rb line:93 time:1416933871.8838577"
</span><span class='line'>"    /home/kk/kk/github/octopress/plugins/tag_generator.rb line:97 time:1416933872.389736"
</span><span class='line'>"    /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb line:297 time:1416933872.4271524"
</span><span class='line'>"    /usr/local/lib/ruby/gems/2.1.0/gems/jekyll-2.5.1/lib/jekyll/site.rb line:301 time:1416933873.8506286"
</span><span class='line'>                    done.
</span><span class='line'> Auto-regeneration: disabled. Use --watch to enable.
</span><span class='line'>"/home/kk/kk/github/octopress/Rakefile line:66 time:1416933873.9671116"
</span><span class='line'>"total = 4.846851825714111"</span></code></pre></td></tr></table></div></figure>


<p>total = 4.846851825714111，不优化要60s左右。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress 加站长统计和站内搜索]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/20/octopress-4/"/>
    <updated>2014-11-20T18:00:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/20/octopress-4</id>
    <content type="html"><![CDATA[<h4>站长统计</h4>

<p>国内使用很广的CNZZ了，注册后，添加并验证你的网站就可以添加统计代码了，选好自己喜欢的样式，获得代码，可添加到source/_includes/custom/footer.html中。即可查看每天你的博客的流量</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script type="text/javascript"&gt;var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<h4>站内搜索</h4>

<p>为了实现站内搜索(页面不跳转)，</p>

<!--more-->


<h5>需要到tapirgo.com注册你的站点，填入atom.xml的url和邮箱地址，tapirgo会生成一对token，我们只使用public token就够了。</h5>

<h5>打开_config.yml文件，加入tapir_token: your_token</h5>

<h5>修改simple_search为你的站点域名simple_search: your_domain</h5>

<h5>在source/javascripts/新建jquery-tapir.js，内容为</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(function($){
</span><span class='line'>  var el;
</span><span class='line'>  var settings = {};
</span><span class='line'>
</span><span class='line'>  var methods = {
</span><span class='line'>    init: function(options) {
</span><span class='line'>      el = this;
</span><span class='line'>
</span><span class='line'>      settings = {
</span><span class='line'>               token: false,
</span><span class='line'>               query_param: 'query'
</span><span class='line'>             };
</span><span class='line'>
</span><span class='line'>      if (options) {
</span><span class='line'>    $.extend(settings, options);
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      if (!settings.token || settings.query_param == '') {
</span><span class='line'>    return this;
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      $.getJSON(
</span><span class='line'>    'http://tapirgo.com/api/1/search.json?token=' + settings.token + '&query=' + paramValue(settings.query_param) + '&callback=?', function(data){
</span><span class='line'>      if(settings['complete']) { settings.complete() }
</span><span class='line'>      $.each(data, function(key, val) {
</span><span class='line'>      document.getElementById('search_results').style.display="block";
</span><span class='line'>      document.getElementById('search_results').style.height="100%";
</span><span class='line'>      document.getElementById('search_results').style.overflow="hidden";
</span><span class='line'>          var str1 = val.content;
</span><span class='line'>          var str2 = str1.substr(1, 250);
</span><span class='line'>          str2 = str2.substr(0, Math.min(str2.length, str2.lastIndexOf(" ")));
</span><span class='line'>        el.append('&lt;div id="content" class="inner"&gt;&lt;article class="post"&gt;&lt;h2 class="title"&gt;&lt;a href="' + val.link + '"&gt;' + val.title + '&lt;/a&gt;&lt;/h2&gt;&lt;div class="entry-content"&gt;&lt;div class="date"&gt;Published on: ' + (val.published_on).substr(0,10) + '&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;p&gt;' + str2 + '...&lt;/p&gt;&lt;br&gt;&lt;a href="' + val.link +'"&gt;Read on &rarr;&lt;/a&gt;&lt;/article&gt;&lt;/div&gt;');
</span><span class='line'>        if(key &gt;= (data.length-1)){
</span><span class='line'>            el.append('&lt;div id="content" class="inner"&gt;&lt;center&gt;&lt;h2 style="border-bottom: 1px solid #ddd;"&gt;Result ends&lt;/h2&gt;&lt;/center&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;');
</span><span class='line'>        }
</span><span class='line'>      });
</span><span class='line'>    }
</span><span class='line'>      );
</span><span class='line'>
</span><span class='line'>      return this;
</span><span class='line'>    }
</span><span class='line'>  };
</span><span class='line'>
</span><span class='line'>  // Extract the param value from the URL.
</span><span class='line'>  function paramValue(query_param) {
</span><span class='line'>    var results = new RegExp('[\\?&]' + query_param + '=([^&#]*)').exec(window.location.href);
</span><span class='line'>    return results ? results[1] : false;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  $.fn.tapir = function(method) {
</span><span class='line'>    if (methods[method]) {
</span><span class='line'>      return methods[ method ].apply(this, Array.prototype.slice.call(arguments, 1));
</span><span class='line'>    } else if (typeof method === 'object' || ! method) {
</span><span class='line'>      return methods.init.apply(this, arguments);
</span><span class='line'>    } else {
</span><span class='line'>      $.error('Method ' +  method + ' does not exist on jQuery.tapir');
</span><span class='line'>    }
</span><span class='line'>  };
</span><span class='line'>
</span><span class='line'>})( jQuery );</span></code></pre></td></tr></table></div></figure>


<h5>然后在source/search/index.html中</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>  layout: default
</span><span class='line'>  ---
</span><span class='line'>  &lt;h1 class="entry-title"&gt;&lt;center&gt;Search Results&lt;/center&gt;&lt;/h1&gt;
</span><span class='line'>  &lt;div id="search_loading" style="margin: 40px 0"&gt;
</span><span class='line'>      &lt;center&gt;&lt;img src="http://abcdxyzk.github.io/images/loading.gif"&gt;&lt;/center&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>  &lt;script type="text/javascript" src="http://abcdxyzk.github.io/javascripts/jquery-tapir.js"&gt;&lt;/script&gt;
</span><span class='line'>  &lt;div id="search_results" style="display:none"&gt;
</span><span class='line'>  &lt;br&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;script&gt;
</span><span class='line'>       $('#search_results').tapir({
</span><span class='line'>           'token': 'your_token',
</span><span class='line'>           'complete' : function() { document.getElementById('search_loading').style.display="none"; }
</span><span class='line'>       });
</span><span class='line'>  &lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<h5>更新source/_includes/navigation.html</h5>

<p>将原来的google搜索</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;input type="hidden" name="q" value="site:smarterhjw.com" /&gt;
</span><span class='line'>&lt;input class="search" type="text" name="q" results="0" placeholder="Search"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>更改为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;input class="search" name="query" type="text" placeholder="Search..." x-webkit-speech /&gt;</span></code></pre></td></tr></table></div></figure>


<p>最后rake generate，就可以了。 此时进行搜索，就不会再跳转到站外去了。</p>

<h5>可以修改一下搜索框展示</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--- a/sass/partials/_navigation.scss
</span><span class='line'>+++ b/sass/partials/_navigation.scss
</span><span class='line'>@@ -74,6 +74,7 @@ body &gt; nav {
</span><span class='line'>       float: right;
</span><span class='line'>       text-align: left;
</span><span class='line'>       padding-left: .8em;
</span><span class='line'>+      padding-top: .35em;
</span><span class='line'>       width: $sidebar-width-medium - $pad-medium*2 - $sidebar-pad-medium + 20px;
</span><span class='line'>       .search {
</span><span class='line'>     width: 93%;
</span><span class='line'>@@ -86,7 +87,7 @@ body &gt; nav {
</span><span class='line'>       .search { width: 91%; }
</span><span class='line'>     }
</span><span class='line'>     fieldset.mobile-nav { display: none; }
</span><span class='line'>-    fieldset[role=search]{ width: 99%; }
</span><span class='line'>+    fieldset[role=search]{ width: 80%; }
</span><span class='line'>   }
</span><span class='line'>   @media only screen and (min-width: 992px) {
</span><span class='line'>     form {</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[markdown部分语法]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/17/blog-markdown/"/>
    <updated>2014-11-17T00:00:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/17/blog-markdown</id>
    <content type="html"><![CDATA[<p><a href="http://wowubuntu.com/markdown/index.html">贴自http://wowubuntu.com/markdown/index.html</a></p>

<h4>段落和换行</h4>

<p>一个 Markdown 段落是由一个或多个连续的文本行组成，它的前后要有一个以上的空行。普通段落不该用空格或制表符来缩进。<br/>
如果你确实想要依赖 Markdown 来插入 <code>&lt;br /&gt;</code> 标签的话，在插入处先按入两个以上的空格然后回车。</p>

<h4>标题</h4>

<p>Markdown 支持两种标题的语法，类 Setext 和类 atx 形式。<br/>
类 Setext 形式是用底线的形式，利用 = （最高阶标题）和 - （第二阶标题），例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>This is an H1
</span><span class='line'>=============
</span><span class='line'>This is an H2
</span><span class='line'>-------------</span></code></pre></td></tr></table></div></figure>


<p>任何数量的 = 和 - 都可以有效果。<br/>
类 Atx 形式则是在行首插入 1 到 6 个 # ，对应到标题 1 到 6 阶，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 这是 H1
</span><span class='line'>## 这是 H2
</span><span class='line'>###### 这是 H6</span></code></pre></td></tr></table></div></figure>


<p>你可以选择性地「闭合」类 atx 样式的标题，这纯粹只是美观用的，若是觉得这样看起来比较舒适，你就可以在行尾加上 #，而行尾的 # 数量也不用和开头一样（行首的井字符数量决定标题的阶数）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 这是 H1 #
</span><span class='line'>## 这是 H2 ##
</span><span class='line'>### 这是 H3 ######</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h4>列表</h4>

<p>Markdown 支持有序列表和无序列表。<br/>
无序列表使用星号、加号或是减号作为列表标记：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*   R
</span><span class='line'>*   Gr
</span><span class='line'>*   B</span></code></pre></td></tr></table></div></figure>


<p>有序列表则使用数字接着一个英文句点：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1.Bird
</span><span class='line'>2.McHale
</span><span class='line'>3.Parish</span></code></pre></td></tr></table></div></figure>


<h4>代码区块</h4>

<p>和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 <code>&lt;pre&gt;</code> 和 <code>&lt;code&gt;</code> 标签来把代码区块包起来。<br/>
要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>这是一个普通段落：
</span><span class='line'>    这是一个代码区块。</span></code></pre></td></tr></table></div></figure>


<p>Markdown 会转换成：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;p&gt;这是一个普通段落：&lt;/p&gt;
</span><span class='line'>&lt;pre&gt;&lt;code&gt;这是一个代码区块。
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;</span></code></pre></td></tr></table></div></figure>


<h4>分隔线</h4>

<p>你可以在一行中用三个以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号或是减号中间插入空格。下面每种写法都可以建立分隔线：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* * *
</span><span class='line'>***
</span><span class='line'>*****
</span><span class='line'>- - -
</span><span class='line'>---------------------------------------</span></code></pre></td></tr></table></div></figure>


<h4>链接</h4>

<p>Markdown 支持两种形式的链接语法： 行内式和参考式两种形式。<br/>
不管是哪一种，链接文字都是用 [方括号] 来标记。<br/>
要建立一个行内式的链接，只要在方块括号后面紧接着圆括号并插入网址链接即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>This is [an example](http://example.com/ "Title") inline link.
</span><span class='line'>[This link](http://example.net/) has no title attribute.</span></code></pre></td></tr></table></div></figure>


<p>会产生：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;p&gt;This is &lt;a href="http://example.com/" title="Title"&gt;
</span><span class='line'>an example&lt;/a&gt; inline link.&lt;/p&gt;
</span><span class='line'>&lt;p&gt;&lt;a href="http://example.net/"&gt;This link&lt;/a&gt; has no
</span><span class='line'>title attribute.&lt;/p&gt;</span></code></pre></td></tr></table></div></figure>


<p>如果你是要链接到同样主机的资源，你可以使用相对路径：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>See my [About](/about/) page for details.</span></code></pre></td></tr></table></div></figure>


<h4>图片</h4>

<p>很明显地，要在纯文字应用中设计一个「自然」的语法来插入图片是有一定难度的。
Markdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： 行内式和参考式。<br/>
行内式的图片语法看起来像是：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![Alt text](/path/to/img.jpg)
</span><span class='line'>![Alt text](/path/to/img.jpg "Optional title")</span></code></pre></td></tr></table></div></figure>


<p>详细叙述如下：<br/>
    一个惊叹号 !<br/>
    接着一个方括号，里面放上图片的替代文字<br/>
    接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上 选择性的 &lsquo;title&rsquo; 文字。<br/>
参考式的图片语法则长得像这样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>![Alt text][id]</span></code></pre></td></tr></table></div></figure>


<p>「id」是图片参考的名称，图片参考的定义方式则和连结参考一样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[id]: url/to/image  "Optional title attribute"</span></code></pre></td></tr></table></div></figure>


<p>到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[树状数组]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/16/alg-bit/"/>
    <updated>2014-11-16T21:19:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/16/alg-bit</id>
    <content type="html"><![CDATA[<p>大体上可以分为两种:</p>

<h4>一</h4>

<p>每次修改的是一个点，所求的是关于某段区间；<br/>
这种情况最好办；比如说poj2352 stars；求每个点前面比他小的点的个数；<br/>
只用设置数组a[],先全是0，然后有某个点就依次修改，并以此统计；<br/>
这一种是最基本的向上修改，向下统计；</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int lowbit(int x) {
</span><span class='line'>    return x&(-x);
</span><span class='line'>}
</span><span class='line'>void update(int x,int num) {
</span><span class='line'>    while(x&lt;=N) {
</span><span class='line'>         d[x]+=num;
</span><span class='line'>         x+=lowbit(x);
</span><span class='line'>     }
</span><span class='line'>}
</span><span class='line'>int getSum(int x) {
</span><span class='line'>    int s=0;
</span><span class='line'>    while(x&gt;0) {
</span><span class='line'>         s+=d[x];
</span><span class='line'>         x-=lowbit(x);
</span><span class='line'>     }
</span><span class='line'>    return s;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h4>二</h4>

<p>每次修改的是一个区间，所求的值是关于某个点的；<br/>
代表的典型题目是HOJ1556 color the ball；<br/>
这个题是每次修改了一整个区间，最后求的是每个点修改的次数；<br/>
这个需要将上面的函数，稍加修改；<br/>
对于[s,t]，要向下修改，将它的区间[0, t]都加一遍update(t)；再向下修改，把不必要的区间[0, s)再减去update(s-1)；</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>void update(int x,int num) {
</span><span class='line'>    while(x&gt;0) {
</span><span class='line'>         d[x]+=num;
</span><span class='line'>         x-=lowbit(x);
</span><span class='line'>     }
</span><span class='line'>}
</span><span class='line'>int getSum(int x) {
</span><span class='line'>    int s=0;
</span><span class='line'>    while(x&lt;=N) {
</span><span class='line'>         s+=d[x];
</span><span class='line'>         x+=lowbit(x);
</span><span class='line'>     }
</span><span class='line'>    return s;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>注意</h5>

<div style="color:red">
对于一，可以用于计算统计子树；</br>
对于二，可以用于计算统计树上某个节点的所有祖先节点
</div>


<h4>poj3321</h4>

<p>这题难的不是树状数组，主要是映射到树状数组。<br/>
建树，然后dfs一次就可以算出对某个节点它的第一个下标(在树状数组中)和最后一个下标。那个更改的时候就用这两个下标就行了。<br/>
<img src="http://abcdxyzk.github.io/images/alg/20141116.png" alt="" /><br/>
类似于将树向右倾斜，dfs建好树后c子树的第一个下标是4，最后一个下标是7。统计子树时只要sum(7)-sum(4-1)</p>

<h4>foj2176</h4>

<p>是poj3321加强版，一样的建树，但是节点要存k个值，然后update和sum的时候注意取和dep的差值，注意update减去val时的dep不要取错，update(le[i], dep[ri[i]], -val);</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;vector&gt;
</span><span class='line'>using namespace std;
</span><span class='line'>
</span><span class='line'>int n,m,mod;
</span><span class='line'>vector&lt;int&gt; tr[50009];
</span><span class='line'>int pre[50009];
</span><span class='line'>int s[50009][5];
</span><span class='line'>int dep[50009];
</span><span class='line'>int now, le[50009], ri[50009];
</span><span class='line'>
</span><span class='line'>int lowbit(int x)
</span><span class='line'>{
</span><span class='line'>    return x&(-x);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>void update(int x, int de, int v)
</span><span class='line'>{
</span><span class='line'>    int i;
</span><span class='line'>    while (x &gt; 0) {
</span><span class='line'>        i = (dep[x]-de+mod*1000000)%mod;
</span><span class='line'>        s[x][i%mod] += v;
</span><span class='line'>        x -= lowbit(x);
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>int sum(int x, int de)
</span><span class='line'>{
</span><span class='line'>    int i, j, val[5], ret;
</span><span class='line'>    for (i=0;i&lt;mod;i++) val[i] = 0;
</span><span class='line'>    while (x &lt;= now) {
</span><span class='line'>        j = i = (de-dep[x]+mod*1000000)%mod;
</span><span class='line'>        for (;i&lt;j+mod;i++)
</span><span class='line'>            val[i%mod] += s[x][i-j];
</span><span class='line'>        x += lowbit(x);
</span><span class='line'>    }
</span><span class='line'>    ret = 0;
</span><span class='line'>    for (i=0;i&lt;mod;i++) ret += (i+1)*val[i];
</span><span class='line'>    return ret;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>void dfs(int k, int d)
</span><span class='line'>{
</span><span class='line'>    int i;
</span><span class='line'>    le[k] = now;
</span><span class='line'>    for (i=0;i&lt;tr[k].size();i++)
</span><span class='line'>        dfs(tr[k][i], d+1);
</span><span class='line'>    now++;
</span><span class='line'>    ri[k] = now;
</span><span class='line'>    dep[now] = d;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>    int i,j,k,l,T,cas=0;
</span><span class='line'>    scanf("%d", &T);
</span><span class='line'>    while (T--)
</span><span class='line'>    {
</span><span class='line'>        cas++;
</span><span class='line'>        printf("Case#%d:\n", cas);
</span><span class='line'>        scanf("%d %d %d", &n, &m, &mod);
</span><span class='line'>        for (i=1;i&lt;=n;i++) tr[i].clear();
</span><span class='line'>        for (i=1;i&lt;n;i++) {
</span><span class='line'>            scanf("%d %d", &j, &k);
</span><span class='line'>            pre[k] = j;
</span><span class='line'>            tr[j].push_back(k);
</span><span class='line'>        }
</span><span class='line'>        for (i=1;i&lt;=n;i++) if (pre[i] == 0) break;
</span><span class='line'>        now = 0;
</span><span class='line'>        dfs(i, 0);
</span><span class='line'>        for (i=0;i&lt;=now;i++)
</span><span class='line'>            for (j=0;j&lt;mod;j++) s[i][j] = 0;
</span><span class='line'>        while (m--) {
</span><span class='line'>            scanf("%d", &l);
</span><span class='line'>            if (l == 1) {
</span><span class='line'>                scanf("%d %d", &j, &k);
</span><span class='line'>                update(ri[j], dep[ri[j]], k);
</span><span class='line'>                update(le[j], dep[ri[j]], -k);
</span><span class='line'>            } else {
</span><span class='line'>                scanf("%d", &j);
</span><span class='line'>                k = sum(ri[j], dep[ri[j]]);
</span><span class='line'>                printf("%d\n", k);
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress分类中使用二级目录]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/13/octopress-3/"/>
    <updated>2014-11-13T23:49:25+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/13/octopress-3</id>
    <content type="html"><![CDATA[<h4>1.修改plugins/category_list_tag.rb为</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># encoding: UTF-8
</span><span class='line'>module Jekyll
</span><span class='line'>    class CategoryListTag &lt; Liquid::Tag
</span><span class='line'>        def render(context)
</span><span class='line'>            html = ""
</span><span class='line'>            pre = ""
</span><span class='line'>            divout = 0
</span><span class='line'>            categories = context.registers[:site].categories.keys
</span><span class='line'>            categories.sort.each do |category|
</span><span class='line'>                posts_in_category = context.registers[:site].categories[category].size
</span><span class='line'>                category_dir = context.registers[:site].config['category_dir']
</span><span class='line'>                cats = category.split(/~/)
</span><span class='line'>                if cats.size &gt; 1 and cats[0] == pre
</span><span class='line'>                    if divout == 0
</span><span class='line'>                        html &lt;&lt; "&lt;div id='#{pre}' class='divclass'&gt;"
</span><span class='line'>                        divout = 1
</span><span class='line'>                    end
</span><span class='line'>                    html &lt;&lt; "&lt;li&gt;&lt;a href='http://abcdxyzk.github.io/#{category_dir}/#{category.to_url}/?opendiv=#{pre}'&gt;#{cats[1]} (#{posts_in_category})&lt;/a&gt;&lt;/li&gt;\n"
</span><span class='line'>                else
</span><span class='line'>                    pre = cats[0]
</span><span class='line'>                    if divout &gt; 0
</span><span class='line'>                        html &lt;&lt; "&lt;/div&gt;"
</span><span class='line'>                        divout = 0
</span><span class='line'>                    end
</span><span class='line'>                    html &lt;&lt; "&lt;li class='category'&gt;&lt;a href='##' onmousedown=showDiv('#{pre}')&gt;#{category} &lt;/a&gt;&lt;a href='http://abcdxyzk.github.io/#{category_dir}/#{category.to_url}/'&gt;(#{posts_in_category})&lt;/a&gt;&lt;/li&gt;\n"
</span><span class='line'>                end
</span><span class='line'>            end
</span><span class='line'>            if divout &gt; 0
</span><span class='line'>                html &lt;&lt; "&lt;/div&gt;"
</span><span class='line'>                divout = 0
</span><span class='line'>            end
</span><span class='line'>            html
</span><span class='line'>        end
</span><span class='line'>    end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>Liquid::Template.register_tag('category_list', Jekyll::CategoryListTag)</span></code></pre></td></tr></table></div></figure>




<!--more-->


<h4>2.修改source/_includes/custom/asides/category_list.html为：注意去掉’\‘</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section&gt;
</span><span class='line'>&lt;h1&gt;Categories&lt;/h1&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;style type="text/css"&gt;
</span><span class='line'>
</span><span class='line'>.divclass
</span><span class='line'>{
</span><span class='line'>    display:none;
</span><span class='line'>    font-size:12px;
</span><span class='line'>    position:relative;
</span><span class='line'>    left:0px;
</span><span class='line'>    top:0px;
</span><span class='line'>    padding:0px 30px 0px 30px;
</span><span class='line'>}
</span><span class='line'>&lt;/style&gt;
</span><span class='line'>&lt;script language="javascript" type="text/javascript"&gt;
</span><span class='line'>
</span><span class='line'>function showDiv(divName)
</span><span class='line'>{
</span><span class='line'>    if (document.getElementById(divName).style.display == "block")
</span><span class='line'>        document.getElementById(divName).style.display = "none"; //隐藏层
</span><span class='line'>    else
</span><span class='line'>        document.getElementById(divName).style.display = "block"; //显示层
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function GetRequest(name) {
</span><span class='line'>    var url = location.search; //获取url中"?"符后的字串
</span><span class='line'>       if (url.indexOf("?") != -1) {
</span><span class='line'>        var str = url.substr(1);
</span><span class='line'>        strs = str.split("&");
</span><span class='line'>        for(var i = 0; i &lt; strs.length; i ++) {
</span><span class='line'>            if (name == strs[i].split("=")[0])
</span><span class='line'>            return unescape(strs[i].split("=")[1]);
</span><span class='line'>          }
</span><span class='line'>       }
</span><span class='line'>       return null;
</span><span class='line'>}
</span><span class='line'>&lt;/script&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;div id="menu"&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>{\% category_list \%}
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>
</span><span class='line'>&lt;script language="javascript" type="text/javascript"&gt;
</span><span class='line'>var divname = GetRequest("opendiv");
</span><span class='line'>if (divname != null)
</span><span class='line'>    showDiv(divname)
</span><span class='line'>&lt;/script&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<h4>3.使用二级标签的时候先写一个一级标签，写一个一级~二级标签，例如：</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> categories:
</span><span class='line'> - hello
</span><span class='line'> - hello~hi</span></code></pre></td></tr></table></div></figure>


<h4>4.add</h4>

<h5>后来又改成了三级目录，显示调整，单列时间分类等。具体去看源码对应文件。</h5>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress侧边栏添加内容]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/13/octopress-2/"/>
    <updated>2014-11-13T23:21:52+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/13/octopress-2</id>
    <content type="html"><![CDATA[<h4>1.添加about页面</h4>

<p>rake new_page[about]<br/>
会生成 source/about/index.markdown 文件。<br/>
编辑该文件的内容。<br/>
然后在头部导航菜单中添加页面的超链接。具体做法是编辑 /source/_includes/custom/navigation.html 文件。</p>

<h4>2.增加链接</h4>

<p>在source/_includes/custom/asides创建blog_link.html，代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section&gt;
</span><span class='line'>&lt;h1&gt;link&lt;/h1&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>        &lt;li&gt;
</span><span class='line'>                &lt;a href=http://hi.baidu.com/abcdxyzk target=_blank&gt;My&lt;/a&gt;
</span><span class='line'>        &lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>然后修改_config.yml文件在default_asides中加入custom/asides/blog_link.html。</p>

<!--more-->


<h4>3.支持评论</h4>

<p>Octopress自身不支持评论功能，不过我们可以使用第三方的评论系统，国外的有Disqus。下面介绍怎样在Octopress中使用Disqus。<br/>
首先需要在Disqus注册一个账号，登录后点击Add Disqus to your site，然后添加站点信息site name和url，记下右侧的name<br/>
然后在_config.yml文件中进行下面设置</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Disqus Comments
</span><span class='line'>disqus_short_name: 为添加站点信息时的name
</span><span class='line'>disqus_show_comment_count: true</span></code></pre></td></tr></table></div></figure>


<h4>4.添加Categories侧边栏</h4>

<p>增加category_list插件<br/>
保存到 plugins/category_list_tag.rb：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># encoding: UTF-8
</span><span class='line'>    module Jekyll
</span><span class='line'>            class CategoryListTag &lt; Liquid::Tag
</span><span class='line'>                    def render(context)
</span><span class='line'>                            html = ""
</span><span class='line'>                            categories = context.registers[:site].categories.keys
</span><span class='line'>                            categories.sort.each do |category|
</span><span class='line'>                                    posts_in_category = context.registers[:site].categories[category].size
</span><span class='line'>                                    category_dir = context.registers[:site].config['category_dir']
</span><span class='line'>                                    html &lt;&lt; "&lt;li class='category'&gt;&lt;a href='http://abcdxyzk.github.io/#{category_dir}/#{category.to_url}/'&gt;#{category} (#{posts_in_category})&lt;/a&gt;&lt;/li&gt;\n"
</span><span class='line'>                            end
</span><span class='line'>                            html
</span><span class='line'>                    end
</span><span class='line'>            end
</span><span class='line'>    end
</span><span class='line'>Liquid::Template.register_tag('category_list', Jekyll::CategoryListTag)</span></code></pre></td></tr></table></div></figure>


<p>注意：一定要在文件的开始添加# encoding: UTF-8这一行，否则无法支持中文分类。<br/>
增加aside<br/>
保存到 source/_includes/asides/category_list.html：注意去掉'\'</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section&gt;
</span><span class='line'>    &lt;h1&gt;Categories&lt;/h1&gt;
</span><span class='line'>    &lt;ul id="categories"&gt;
</span><span class='line'>        {\% category_list \%}
</span><span class='line'>    &lt;/ul&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>修改_config.yml文件<br/>
将category_list添加到default_asides：<br/>
   default_asides: [asides/category_list.html, asides/recent_posts.html]<br/>
安装这个插件后直接可以支持中文分类，url中使用的是分类的拼音，如「数据库」对应「shu-ju-ku」。如果使用中文分类时遇到各种错误，请参考下面这两篇文章：</p>

<pre><code>http://aiku.me/bar/10393365  
http://blog.sprabbit.com/blog/2012/03/23/octopress/  
</code></pre>

<h4>5.添加tag</h4>

<p>首先到<a href="https://github.com/robbyedwards/octopress-tag-pages  ">https://github.com/robbyedwards/octopress-tag-pages  </a>
和<a href="https://github.com/robbyedwards/octopress-tag-cloudclone  ">https://github.com/robbyedwards/octopress-tag-cloudclone  </a>
这两个项目的代码。这两个项目分别用于产生tag page和tag cloud。 针对这两个插件，需要手工复制一些文件到你的octopress目录。</p>

<p>octopress-tag-pages<br/>
复制tag_generator.rb到plugins目录；<br/>
复制tag_index.html到source/<em>layouts目录。<br/>
复制tag_feed.xml到source/</em>includes/custom/目录。tag_feed.xml文件中 layout: nil 改为 layout: null<br/>
其他文件就不需要复制了，都是些例子。</p>

<p>octopress-tag-cloud<br/>
仅复制tag_cloud.rb到plugins目录即可。<br/>
添加aside，复制以下代码到source/_includes/custom/asides/tags.html。注意去掉'\'</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section&gt;
</span><span class='line'>    &lt;h1&gt;Tags&lt;/h1&gt;
</span><span class='line'>    &lt;ul class="tag-cloud"&gt;
</span><span class='line'>        {\% tag_cloud font-size: 90-210%, limit: 100, style: para \%}
</span><span class='line'>    &lt;/ul&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>tag_cloud的参数中，style :para指定不使用li来分割，limit限定100个tag，font-size指定tag的大小范围，具体参数参看官方文档。<br/>
最后，当然是在_config.xml的default_asides 中添加这个tag cloud到导航栏：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>default_asides: [... custom/asides/tags.html, ...]</span></code></pre></td></tr></table></div></figure>


<h5>bug:</h5>

<p>除0错误，tag_cloud.rb中<br/>
weight = (Math.log(count) - Math.log(min))/(Math.log(max) - Math.log(min))<br/>
当max==min时出错<br/>
一下修复同时改成像Categories一样显示文章数</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--- a/plugins/tag_cloud.rb
</span><span class='line'>+++ b/plugins/tag_cloud.rb
</span><span class='line'>@@ -54,7 +54,7 @@ def initialize(name, params, tokens)
</span><span class='line'> # map: [[tag name, tag count]] -&gt; [[tag name, tag weight]]
</span><span class='line'>        weighted = count.map do |name, count|
</span><span class='line'> # logarithmic distribution
</span><span class='line'>-       weight = (Math.log(count) - Math.log(min))/(Math.log(max) - Math.log(min))
</span><span class='line'>+       weight = count
</span><span class='line'>        [name, weight]
</span><span class='line'>        end
</span><span class='line'> # get the top @limit tag pairs when a limit is given, unless the sort method is random
</span><span class='line'>@@ -92,12 +92,17 @@ def initialize(name, params, tokens)
</span><span class='line'>        html = ""
</span><span class='line'> # iterate over the weighted tag Array and create the tag items
</span><span class='line'>        weighted.each_with_index do |tag, i|
</span><span class='line'>-       name, weight = tag
</span><span class='line'>+       name, weight_orig = tag
</span><span class='line'>+        if min == max
</span><span class='line'>+               weight = 0.5
</span><span class='line'>+       else
</span><span class='line'>+               weight = (Math.log(weight_orig) - Math.log(min))/(Math.log(max) - Math.log(min))
</span><span class='line'>+       end
</span><span class='line'>        size = size_min + ((size_max - size_min) * weight).to_f
</span><span class='line'>        size = sprintf("%.#{@precision}f", size)
</span><span class='line'>        slug = name.to_url
</span><span class='line'>        @separator = "" if i == (weighted.size - 1)
</span><span class='line'>-       html &lt;&lt; "#{@tag_before}&lt;a style=\"font-size: #{size}#{unit}\" href=\"/#{dir}/#{slug}/\"&gt;#{name}&lt;/a&gt;#{@separator}#{@tag_after}\n"
</span><span class='line'>+       html &lt;&lt; "#{@tag_before}&lt;a style=\"font-size: #{size}#{unit}\" href=\"/#{dir}/#{slug}/\"&gt;#{name}(#{weight_orig})&lt;/a&gt;#{@separator}#
</span><span class='line'>        end
</span><span class='line'>        html
</span><span class='line'>        end</span></code></pre></td></tr></table></div></figure>


<h6>如果会出现:</h6>

<p>添加超过一个tags之后，rake generate就会开始报错了： Error :Liquid Exception: comparison of Array with Array failed in page<br/>
只需要将1个tag重复2次以上使用就可以解决。<br/>
1.第1个post加的tag是：tag1，第2个post加的tag是：tag1<br/>
2.rake generate<br/>
3.第2个post的tag随便改：tagXXX</p>

<h4>6.近期评论</h4>

<p>复制以下代码到source/_includes/custom/asides/recent_comments.html，名字改成自己的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section id="comment_sidebar"&gt;
</span><span class='line'>&lt;h1&gt;近期评论&lt;/h1&gt;
</span><span class='line'>&lt;script type="text/javascript" src="http://abcdxyzk.disqus.com/recent_comments_widget.js?num_items=10&hide_avatars=0&avatar_size=32&excerpt_length=20"&gt;&lt;/script&gt;&lt;a href="http://disqus.com/"&gt;Powered by Disqus&lt;/a&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>修改<em>config.yml<br/>
最后，当然是在</em>config.xml的default_asides 中添加这个tag cloud到导航栏：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>default_asides: [... custom/asides/recent_comments.html, ...]</span></code></pre></td></tr></table></div></figure>


<h4>7.优化</h4>

<p>删除<br/>
 source/<em>includes/custom/head.html<br/>
 source/</em>includes/head.html<br/>
中googleapis</p>

<h4>8.BUG，最新octopress的已经修复</h4>

<p>除了根目录，其他目录无法将右侧缩到底部。<br/>
可以修改一下source/_includes/head.html文件，去掉src中的'.&lsquo;，改成如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;script&gt;!window.jQuery && document.write(unescape('%3Cscript src="http://abcdxyzk.github.io/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress+github建立个人博客]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/13/octopress-1/"/>
    <updated>2014-11-13T22:59:03+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/13/octopress-1</id>
    <content type="html"><![CDATA[<h4>Step 1 安装git ruby nodejs</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install git zlib1g-dev libyaml-dev openssl libssl-dev tcl-dev tk-dev node/nodejs
</span><span class='line'>sudo apt-get install ruby ruby-dev 安装的版本偏低不行，要1.9.3以上https://www.ruby-lang.org/en/downloads/</span></code></pre></td></tr></table></div></figure>


<h4>Step 2 准备octopress</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'>cd octopress    # 如果你使用RVM, 你会被询问你是否信任 .rvmrc 文件 (选择 yes).
</span><span class='line'>ruby --version  # 这条命令应该输出 Ruby 1.9.3
</span><span class='line'>然后安装依赖
</span><span class='line'>sudo gem install bundler
</span><span class='line'>rbenv rehash    # 如果你使用 rbenv, 执行 rehash 以运行 bundle 命令 (好像不需要这条)
</span><span class='line'>bundle install    # 在octopress目录运行
</span><span class='line'>最后安装默认主题
</span><span class='line'>rake install</span></code></pre></td></tr></table></div></figure>




<!--more-->


<h4>Step 3 部署到github上</h4>

<p>(1)以 用户名/用户名.github.io 的格式建立一个新项目。<br/>
(2)部署<br/>
首先运行<br/>
rake setup_github_pages<br/>
这条命令会询问你刚才建立的项目的地址，按提示输入，然后就会生成一些用于部署的文件和<em>deploy目录，</em>deploy目录就是对应master分支。 接着执行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate
</span><span class='line'>rake deploy  # 会cd到_deploy目录运行 commit 和 push</span></code></pre></td></tr></table></div></figure>


<p>这两条命令会生成博客内容，然后添加到git中，自动执行git commit然后推送到主分支(master branch)。几分钟后，你会收到github通知你你的提交已经被接受并发布了你的网站的email。</p>

<p>rake generate可能报错：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Error reading file /var/lib/gems/1.9.1/gems/jekyll-sitemap-0.6.1/lib/sitemap.xml: No such file or directory - /home/kk/kk/github/octopress/source/var/lib/gems/1.9.1/gems/jekyll-sitemap-0.6.1/lib/sitemap.xml</span></code></pre></td></tr></table></div></figure>


<p>是jekyll-sitemap-0.6.1的bug，修改Gemfile.lock, jekyll-sitemap (0.6.1) 改成 jekyll-sitemap (0.6.3), 再</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<p>不要忘记把为你的博客提交source（Don’t forget to commit the source for your blog）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m 'your message'
</span><span class='line'>git push origin source # 记住只push source，要push master就得先pull一下，因为_deploy目录也对应master，而他一运行rake deploy就会push</span></code></pre></td></tr></table></div></figure>


<h4>Step 4 发布博客</h4>

<p>你发布的文章被放在source/<em>posts目录下，并按照Jekyll的命名规则命名：YYYY-MM-DD-post- title.markdown。这个名字会被用于生成url且日期会被用于为文章按时间排序。 但这样比较麻烦，于是Octopress提供了一个rake task来自动按照正确的命名规则建立博文，并生成基本内容。<br/>
格式是：rake new_post[&ldquo;title&rdquo;]<br/>
样例：<br/>
    rake new_post[&ldquo;tt&rdquo;]<br/>
    # 这条命令会创建 source/</em>posts/2011-07-03-tt.markdown文件<br/>
会生成如下内容的文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>layout: post
</span><span class='line'>title: "tt"
</span><span class='line'>date: 2011-07-03 5:59
</span><span class='line'>comments: true
</span><span class='line'>external-url:
</span><span class='line'>categories:
</span><span class='line'>---</span></code></pre></td></tr></table></div></figure>


<p>你可以在这里设置评论功能开关，设置分类。如果你的博客有多个作者共用，你可以在文件中添加【author:Your Name】。如果你在编辑一个草稿，你可以添加【published： false】以使其在生成博客内容时被自动忽略。</p>

<h4>Step 5 生成 &amp; 预览</h4>

<p>rake generate # 在公开目录中生成博文和页面
rake watch # 查看 source/ and sass/ 的改动
rake preview # 在浏览器中输入 <a href="http://localhost:4000">http://localhost:4000</a> 即可预览。</p>

<h4>Step 6 推送到github</h4>

<p>rake deploy
然后过几分钟，github就会自动更新你的博客了。<br/>
注意：执行rake deploy前一定要先rake generate一下<br/>
不要忘记把为你的博客提交source（Don’t forget to commit the source for your blog）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m 'your message'
</span><span class='line'>git push origin source </span></code></pre></td></tr></table></div></figure>


<hr />

<h4>另一台机子的时候</h4>

<p>安装需要软件，然后clone自己的代码库</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git checkout -b source origin/source
</span><span class='line'>sudo gem install bundler
</span><span class='line'>bundle install
</span><span class='line'>rake install
</span><span class='line'>rake setup_github_pages
</span><span class='line'>mkdir _deploy
</span><span class='line'>cd _deploy
</span><span class='line'>git init
</span><span class='line'>git remote add origin git@github.com:abcdxyzk/abcdxyzk.github.io.git
</span><span class='line'>git pull origin master
</span><span class='line'>cd ..</span></code></pre></td></tr></table></div></figure>


<p><em>deploy目录就是对应master分支，所以必须要先保持一致<br/>
不然先运行rake deploy会在</em>deploy目录先commit，再push，这就会导致其他和另外机子上提交的冲突。<br/>
如果先rake deploy的话，可以在_deploy目录reset回去，然后pull。</p>

<p>记住多台机子操作的时候一开始先</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>需要保持_deploy/.git/config有master分支
</span><span class='line'>git pull
</span><span class='line'>cd _deploy
</span><span class='line'>git pull</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[css 二级菜单]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/13/lang-css-menu/"/>
    <updated>2014-11-13T14:52:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/13/lang-css-menu</id>
    <content type="html"><![CDATA[<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;style type="text/css"&gt;
</span><span class='line'>
</span><span class='line'>.divclass
</span><span class='line'>{
</span><span class='line'>    display:none;
</span><span class='line'>    font-size:12px;
</span><span class='line'>    position:relative;
</span><span class='line'>    left:0px;
</span><span class='line'>    top:0px;
</span><span class='line'>    padding:5px 10px 0px 10px;
</span><span class='line'>    width:320px;
</span><span class='line'>}
</span><span class='line'>&lt;/style&gt;
</span><span class='line'>&lt;script language="javascript" type="text/javascript"&gt;
</span><span class='line'>
</span><span class='line'>function showDiv(divName)
</span><span class='line'>{
</span><span class='line'>    if (document.getElementById(divName).style.display == "block")
</span><span class='line'>        document.getElementById(divName).style.display = "none"; //隐藏层
</span><span class='line'>    else
</span><span class='line'>        document.getElementById(divName).style.display = "block"; //显示层
</span><span class='line'>}
</span><span class='line'>&lt;/script&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;div id="menu"&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="#" onmousedown="showDiv('div1')"&gt;菜单一&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>    &lt;div id="div1" class=divclass&gt;
</span><span class='line'>    &lt;a href="#" onmousedown="showDiv('div2')"&gt;子菜单一&lt;/a&gt;
</span><span class='line'>        &lt;div id="div2" class=divclass&gt;
</span><span class='line'>        &lt;ul&gt;
</span><span class='line'>        &lt;li&gt;&lt;a href="#"&gt;子菜单一&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>        &lt;li&gt;&lt;a href="#"&gt;子菜单二&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>        &lt;ul&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="#" onmousedown="showDiv('div3')"&gt;菜单三&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;div id="div3" class=divclass&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="#" onmousedown="showDiv('div4')"&gt;菜单四&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;div id="div4" class=divclass&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>    &lt;li&gt;&lt;a href="#"&gt;子菜单一&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>    &lt;li&gt;&lt;a href="#"&gt;子菜单二&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>&lt;script language="javascript" type="text/javascript"&gt;
</span><span class='line'>showDiv('div1');
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hello]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/08/hello/"/>
    <updated>2014-11-08T18:19:17+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/08/hello</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ar ranlib nm 命令--制作.a文件]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/06/command-ar/"/>
    <updated>2014-11-06T23:08:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/06/command-ar</id>
    <content type="html"><![CDATA[<h4>1.ar基本用法</h4>

<h5>功能说明：建立或修改备存文件，或是从备存文件中抽取文件。</h5>

<p>ar命令可以用来创建、修改库，也可以从库中提出单个模块。库是一单独的文件，里面包含了按照特定的结构组织起来的其它的一些文件（称做此库文件的member）。原始文件的内容、模式、时间戳、属主、组等属性都保留在库文件中。</p>

<!--more-->


<h5>下面是ar命令的格式：</h5>

<p>　　ar [-]{dmpqrtx}[abcfilNoPsSuvV] [membername] [count] archive files&hellip;<br/>
　　例如我们可以用ar rv libtest.a hello.o hello1.o来 生成一个库，库名字是test，链接时可以用-ltest链接。该库中存放了两个模块hello.o和hello1.o。选项前可以有‘-&lsquo;字符，也可以 没有。下面我们来看看命令的操作选项和任选项。现在我们把{dmpqrtx}部分称为操作选项，而[abcfilNoPsSuvV]部分称为任选项。<br/>
　　{dmpqrtx}中的操作选项在命令中只能并且必须使用其中一个，它们的含义如下：<br/>
    d：从库中删除模块。按模块原来的文件名指定要删除的模块。如果使用了任选项v则列出被删除的每个模块。<br/>
    m：该操作是在一个库中移动成员。当库中如果有若干模块有相同的符号定义(如函数定义)，则成员的位置顺序很重要。如果没有指定任选项，任何指定的成员将移到库的最后。也可以使用'a'，'b'，或'I'任选项移动到指定的位置。<br/>
    p：显示库中指定的成员到标准输出。如果指定任选项v，则在输出成员的内容前，将显示成员的名字。如果没有指定成员的名字，所有库中的文件将显示出来。<br/>
    q：快速追加。增加新模块到库的结尾处。并不检查是否需要替换。'a'，'b'，或'I'任选项对此操作没有影响，模块总是追加的库的结尾处。如果使用了任选项v则列出每个模块。 这时，库的符号表没有更新，可以用'ar s'或ranlib来更新库的符号表索引。<br/>
    r：在库中插入模块(替换)。当插入的模块名已经在库中存在，则替换同名的模块。如果若干模块中有一个模块在库中不存在，ar显示一个错误消息，并不替换其他同名模块。默认的情况下，新的成员增加在库的结尾处，可以使用其他任选项来改变增加的位置。<br/>
    t：显示库的模块表清单。一般只显示模块名。<br/>
    x：从库中提取一个成员。如果不指定要提取的模块，则提取库中所有的模块。<br/>
　　下面在看看可与操作选项结合使用的任选项：<br/>
    a：在库的一个已经存在的成员后面增加一个新的文件。如果使用任选项a，则应该为命令行中membername参数指定一个已经存在的成员名。<br/>
    b：在库的一个已经存在的成员前面增加一个新的文件。如果使用任选项b，则应该为命令行中membername参数指定一个已经存在的成员名。<br/>
    c：创建一个库。不管库是否存在，都将创建。<br/>
    f：在库中截短指定的名字。缺省情况下，文件名的长度是不受限制的，可以使用此参数将文件名截短，以保证与其它系统的兼容。<br/>
    i：在库的一个已经存在的成员前面增加一个新的文件。如果使用任选项i，则应该为命令行中membername参数指定一个已经存在的成员名(类似任选项b)。<br/>
    l：暂未使用<br/>
    N：与count参数一起使用，在库中有多个相同的文件名时指定提取或输出的个数。<br/>
    o：当提取成员时，保留成员的原始数据。如果不指定该任选项，则提取出的模块的时间将标为提取出的时间。<br/>
    P：进行文件名匹配时使用全路径名。ar在创建库时不能使用全路径名（这样的库文件不符合POSIX标准），但是有些工具可以。<br/>
    s：写入一个目标文件索引到库中，或者更新一个存在的目标文件索引。甚至对于没有任何变化的库也作该动作。对一个库做ar s等同于对该库做ranlib。<br/>
    S：不创建目标文件索引，这在创建较大的库时能加快时间。<br/>
    u：一般说来，命令ar r&hellip;插入所有列出的文件到库中，如果你只想插入列出文件中那些比库中同名文件新的文件，就可以使用该任选项。该任选项只用于r操作选项。<br/>
    v：该选项用来显示执行操作选项的附加信息。<br/>
    V：显示ar的版本。</p>

<h4>2.ranlib命令</h4>

<p>静态库文件需要使用“ar”来创建和维护。当给静态库增建一个成员时（加入一个.o文件到静态库中），“ar”可直接 将需要增加的.o文件简单的追加到静态库的末尾。之后当我们使用这个库进行连接生成可执行文件时，链接程序“ld”却提示错误，这可能是：主程序使用了之 前加入到库中的.o文件中定义的一个函数或者全局变量，但连接程序无法找到这个函数或者变量。</p>

<p>这个问题的原因是：之前我们将编译完成的.o文件直接加入到了库的末尾，却并没有更新库的有效符号表。连接程序进行连接时，在静态库的符号索引表中无法定 位刚才加入的.o文件中定义的函数或者变量。这就需要在完成库成员追加以后让加入的所有.o文件中定义的函数（变量）有效，完成这个工作需要使用另外一个 工具“ranlib”来对静态库的符号索引表进行更新。</p>

<p>我们所使用到的静态库（文档文件）中，存在这样一个特殊的成员，它的名字是“<strong>.SYMDEF”。它包含了静态库中所有成员所定义的有效符号（函数名、 变量名）。因此，当为库增加了一个成员时，相应的就需要更新成员“</strong>.SYMDEF”，否则所增加的成员中定义的所有的符号将无法被连接程序定位。完成 更新的命令是：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ranlib ARCHIVEFILE </span></code></pre></td></tr></table></div></figure>


<p>通常在Makefile中我们可以这样来实现：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libfoo.a: libfoo.a(x.o) libfoo.a(y.o) ... 
</span><span class='line'>ranlib libfoo.a </span></code></pre></td></tr></table></div></figure>


<p>它所实现的是在更新静态库成员“x.o”和“y.o”之后，对静态库的成员“__.SYMDEF”进行更新（更新库的符号索引表）。
如果我们使用GNU ar工具来维护、管理静态库，我们就不需要考虑这一步。GNU ar本身已经提供了在更新库的同时更新符号索引表的功能（这是默认行为，也可以通过命令行选项控制ar的具体行为。可参考 GNU ar工具的man手册）。</p>

<p>GNU工具中ar是用来制作库文件.a的，但同时还提供了一个ranlib，从手册上看ranlib相当于ar -s，为什么这样呢？<br/>
这是由于最早在Unix系统上ar程序是单纯用来打包多个.o到.a（类似于tar做的事情），而不处理.o里的符号表。Linker程序则需 要.a文件提供一个完整的符号表，所以当时就写了单独的ranlib程序用来产生linker所需要的符号信息。也就是说，产生一个对linker合 格的的.a文件需要做ar和ranlib两步 。<br/>
很快，Unix厂商就发现ranlib做得事情完全可以合并到ar里面去，于是ar程序的升级版本就包括了ranlib的功能，但早期的很多项目的Makefile都已经是按照两步式的方法生成.a，所以为了保证这些早期文件的兼容性，ranlib被保留下来了。<br/>
如今，GNU/Linux系统上，ranlib依然存在，当然大部分项目已经不使用它了，因为ar -s就做了ranlib的工作。<br/>
历史通常是进步和妥协的混合！</p>

<h4>3.nm基本用法命令</h4>

<p>　　nm用来列出目标文件的符号清单。下面是nm命令的格式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nm [-a|--debug-syms] [-g|--extern-only] [-B][-C|--demangle] [-D|--dynamic] [-s|--print-armap][-o|--print-file-name] [-n|--numeric-sort][-p|--no-sort] [-r|--reverse-sort] [--size-sort][-u|--undefined-only] [-l|--line-numbers] [--help][--version] [-t radix|--radix=radix][-P|--portability] [-f format|--format=format][--target=bfdname] [objfile...]</span></code></pre></td></tr></table></div></figure>


<p>如果没有为nm命令指出目标文件，则nm假定目标文件是a.out。下面列出该命令的任选项，大部分支持"-&ldquo;开头的短格式和"—"开头的长格式。<br/>
-A、-o或&ndash;print-file-name：在找到的各个符号的名字前加上文件名，而不是在此文件的所有符号前只出现文件名一次。<br/>
    例如nm libtest.a的输出如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CPThread.o:
</span><span class='line'>00000068 T Main__8CPThreadPv
</span><span class='line'>00000038 T Start__8CPThread
</span><span class='line'>00000014 T _._8CPThread
</span><span class='line'>00000000 T __8CPThread
</span><span class='line'>00000000 ? __FRAME_BEGIN__
</span><span class='line'>.......................................
</span><span class='line'>则nm -A 的输出如下：
</span><span class='line'>libtest.a:CPThread.o:00000068 T Main__8CPThreadPv
</span><span class='line'>libtest.a:CPThread.o:00000038 T Start__8CPThread
</span><span class='line'>libtest.a:CPThread.o:00000014 T _._8CPThread
</span><span class='line'>libtest.a:CPThread.o:00000000 T __8CPThread
</span><span class='line'>libtest.a:CPThread.o:00000000 ? __FRAME_BEGIN__
</span><span class='line'>..................................................................</span></code></pre></td></tr></table></div></figure>


<p>nm命令<br/>
    -a或&ndash;debug-syms：显示调试符号。<br/>
    -B：等同于&ndash;format=bsd，用来兼容MIPS的nm。<br/>
    -C或&ndash;demangle：将低级符号名解码(demangle)成用户级名字。这样可以使得C++函数名具有可读性。<br/>
    -D或&ndash;dynamic：显示动态符号。该任选项仅对于动态目标(例如特定类型的共享库)有意义。<br/>
    -f format：使用format格式输出。format可以选取bsd、sysv或posix，该选项在GNU的nm中有用。默认为bsd。<br/>
    -g或&ndash;extern-only：仅显示外部符号。<br/>
    -n、-v或&ndash;numeric-sort：按符号对应地址的顺序排序，而非按符号名的字符顺序。<br/>
    -p或&ndash;no-sort：按目标文件中遇到的符号顺序显示，不排序。<br/>
    -P或&ndash;portability：使用POSIX.2标准输出格式代替默认的输出格式。等同于使用任选项-f posix。<br/>
    -s或&ndash;print-armap：当列出库中成员的符号时，包含索引。索引的内容包含：哪些模块包含哪些名字的映射。<br/>
    -r或&ndash;reverse-sort：反转排序的顺序(例如，升序变为降序)。<br/>
    &ndash;size-sort：按大小排列符号顺序。该大小是按照一个符号的值与它下一个符号的值进行计算的。<br/>
    -t radix或&ndash;radix=radix：使用radix进制显示符号值。radix只能为"d"表示十进制、"o"表示八进制或"x"表示十六进制。<br/>
    &ndash;target=bfdname：指定一个目标代码的格式，而非使用系统的默认格式。<br/>
    -u或&ndash;undefined-only：仅显示没有定义的符号(那些外部符号)。<br/>
    -l或&ndash;line-numbers：对每个符号，使用调试信息来试图找到文件名和行号。对于已定义的符号，查找符号地址的行号。对于未定义符号，查找指向符号重定位入口的行号。如果可以找到行号信息，显示在符号信息之后。<br/>
    -V或&ndash;version：显示nm的版本号。<br/>
    &ndash;help：显示nm的任选项。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[gcc同时使用动态和静态链接]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/06/complier-static-dynamic-ld/"/>
    <updated>2014-11-06T14:51:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/06/complier-static-dynamic-ld</id>
    <content type="html"><![CDATA[<p>gcc &ndash;static a.c -Wl,-Bstatic -lm -Wl,-Bdynamic -lc</p>

<p>其中用到的两个选项：-Wl,-Bstatic和-Wl,-Bdynamic。这两个选项是gcc的特殊选项，它会将选项的参数传递给链接器，作为 链接器的选项。比如-Wl,-Bstatic告诉链接器使用-Bstatic选项，该选项是告诉链接器，对接下来的-l选项使用静态链 接；-Wl,-Bdynamic就是告诉链接器对接下来的-l选项使用动态链接。下面是man gcc对-Wl,option的描述，</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-Wl,option  
</span><span class='line'>       Pass option as an option to the linker.  If option contains commas, it is   
</span><span class='line'>       split into multiple options at the commas.  You can use this syntax to pass  
</span><span class='line'>       an argument to the option.  For example, -Wl,-Map,output.map passes -Map output.map  
</span><span class='line'>       to the linker.  When using the GNU linker, you can also get the same effect with   
</span><span class='line'>       -Wl,-Map=output.map.  </span></code></pre></td></tr></table></div></figure>


<p>下面是man ld分别对-Bstatic和-Bdynamic的描述，</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-Bdynamic  
</span><span class='line'>-dy  
</span><span class='line'>-call_shared  
</span><span class='line'>       Link against dynamic libraries. You may use this option multiple times on the  
</span><span class='line'>       command line: it affects library searching for -l options which follow it.  
</span><span class='line'>
</span><span class='line'>-Bstatic  
</span><span class='line'>-dn  
</span><span class='line'>-non_shared  
</span><span class='line'>-static  
</span><span class='line'>       Do not link against shared libraries. You may use this option multiple times on   
</span><span class='line'>       the command line: it affects library searching for -l options which follow it.   
</span><span class='line'>       This option also implies --unresolved-symbols=report-all.  This option can be   
</span><span class='line'>       used with -shared.  Doing so means that a shared library is being created but   
</span><span class='line'>       that all of the library's external references must be resolved by pulling in   
</span><span class='line'>       entries from static libraries.  </span></code></pre></td></tr></table></div></figure>


<p>　　值得注意的是对-static的描述：-static和-shared可以同时存在，这样会创建共享库，但该共享库引用的其他库会静态地链接到该共享库中。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GCC制作Library--shared部分相当不错]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/06/compiler-gcc-lib/"/>
    <updated>2014-11-06T14:49:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/06/compiler-gcc-lib</id>
    <content type="html"><![CDATA[<p><a href="http://blog.csdn.net/alex_ww/article/details/4544207">贴自http://blog.csdn.net/alex_ww/article/details/4544207</a></p>

<h3>Library可分成三种，static、shared与dynamically loaded。</h3>

<h4>1. Static libraries</h4>

<p>Static 链接库用于静态链接，简单讲是把一堆object檔用ar(archiver)包装集合起来，文件名以 `.a' 结尾。优点是执行效能通常会比后两者快，而且因为是静态链接，所以不易发生执行时找不到library或版本错置而无法执行的问题。缺点则是档案较大，维护度较低；例如library如果发现bug需要更新，那么就必须重新连结执行档。</p>

<h5>1.1 编译</h5>

<p>编译方式很简单，先例用 `-c' 编出 object 檔，再用 ar 包起来即可。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>____ hello.c ____
</span><span class='line'>#include
</span><span class='line'>void hello(){ printf("Hello "); }
</span><span class='line'>____ world.c ____
</span><span class='line'>#include
</span><span class='line'>void world(){ printf("world."); }
</span><span class='line'>____ mylib.h ____
</span><span class='line'>void hello();
</span><span class='line'>void world();</span></code></pre></td></tr></table></div></figure>


<p>$ gcc -c hello.c world.c /* 编出 hello.o 与 world.o */ <br/>
$ ar rcs libmylib.a hello.o world.o /* 包成 limylib.a */ <br/>
这样就可以建出一个档名为 libmylib.a 的檔。输出的档名其实没有硬性规定，但如果想要配合 gcc 的 &lsquo;-l&rsquo; 参数来连结，一定要以 &lsquo;lib&rsquo; 开头，中间是你要的library名称，然后紧接着 &lsquo;.a&rsquo; 结尾。</p>

<h5>1.2 使用</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>____ main.c ____
</span><span class='line'>#include "mylib.h"
</span><span class='line'>int main() {
</span><span class='line'>hello();
</span><span class='line'>world();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>使用上就像与一般的 object 档连结没有差别。<br/>
$ gcc main.c libmylib.a<br/>
也可以配合 gcc 的 `-l' 参数使用<br/>
$ gcc main.c -L. -lmylib<br/>
&lsquo;-Ldir&rsquo; 参数用来指定要搜寻链接库的目录，'.&lsquo; 表示搜寻现在所在的目录。通常默认会搜 /usr/lib 或 /lib 等目录。<br/>
&rsquo;-llibrary' 参数用来指定要连结的链接库，'mylib' 表示要与mylib进行连结，他会搜寻library名称前加'lib'后接'.a'的档案来连结。<br/>
$ ./a.out<br/>
Hello world.</p>

<h3>2. Shared libraries</h3>

<p>Shared library 会在程序执行起始时才被自动加载。因为链接库与执行档是分离的，所以维护弹性较好。有两点要注意，shared library是在程序起始时就要被加载，而不是执行中用到才加载，而且在连结阶段需要有该链接库才能进行连结。<br/>
首先有一些名词要弄懂，soname、real name与linker name。<br/>
soname 用来表示是一个特定 library 的名称，像是 libmylib.so.1 。前面以 &lsquo;lib&rsquo; 开头，接着是该 library 的名称，然后是 &lsquo;.so&rsquo; ，接着是版号，用来表名他的界面；如果接口改变时，就会增加版号来维护兼容度。<br/>
real name 是实际放有library程序的文件名，后面会再加上 minor 版号与release 版号，像是 libmylib.so.1.0.0 。<br/>
一般来说，版号的改变规则是(印象中在 APress-Difinitive Guide to GCC中有提到，但目前手边没这本书)，最后缀的release版号用于程序内容的修正，接口完全没有改变。中间的minor用于有新增加接口，但相旧接口没改变，所以与旧版本兼容。最前面的version版号用于原接口有移除或改变，与旧版不兼容时。<br/>
linker name是用于连结时的名称，是不含版号的 soname ，如: libmylib.so。<br/>
通常 linker name与 real name是用 ln 指到对应的 real name ，用来提供弹性与维护性。</p>

<h5>2.1 编译</h5>

<p>shared library的制作过程较复杂。<br/>
$ gcc -c -fPIC hello.c world.c<br/>
编译时要加上 -fPIC 用来产生 position-independent code。也可以用 -fpic参数。 (不太清楚差异，只知道 -fPIC 较通用于不同平台，但产生的code较大，而且编译速度较慢)。<br/>
$ gcc -shared -Wl,-soname,libmylib.so.1 -o libmylib.so.1.0.0 /<br/>
hello.o world.o<br/>
-shared 表示要编译成 shared library<br/>
-Wl 用于参递参数给linker，因此-soname与libmylib.so.1会被传给linker处理。<br/>
-soname用来指名 soname 为 limylib.so.1<br/>
library会被输出成libmylib.so.1.0.0 (也就是real name)<br/>
若不指定 soname 的话，在编译结连后的执行档会以连时的library档名为soname，并载入他。否则是载入soname指定的library档案。<br/>
可以利用 objdump 来看 library 的 soname。<br/>
$ objdump -p libmylib.so | grep SONAME<br/>
SONAME libmylib.so.1<br/>
若不指名-soname参数的话，则library不会有这个字段数据。<br/>
在编译后再用 ln 来建立 soname 与 linker name 两个档案。<br/>
$ ln -s libmylib.so.1.0.0 libmylib.so<br/>
$ ln -s libmylib.so.1.0.0 libmylib.so.1</p>

<h5>2.2 使用</h5>

<p>与使用 static library 同。<br/>
$ gcc main.c libmylib.so<br/>
以上直接指定与 libmylib.so 连结。<br/>
或用<br/>
$ gcc main.c -L. -lmylib<br/>
linker会搜寻 libmylib.so 来进行连结。<br/>
如果目录下同时有static与shared library的话，会以shared为主。<br/>
使用 -static 参数可以避免使用shared连结。<br/>
$ gcc main.c -static -L. -lmylib<br/>
此时可以用 ldd 看编译出的执行档与shared链接库的相依性<br/>
$ldd a.out<br/>
linux-gate.so.1 => (0xffffe000)<br/>
libmylib.so.1 => not found<br/>
libc.so.6 => /lib/libc.so.6 (0xb7dd6000)<br/>
/lib/ld-linux.so.2 (0xb7f07000)<br/>
输出结果显示出该执行文件需要 libmylib.so.1 这个shared library。<br/>
会显示 not found 因为没指定该library所在的目录，所找不到该library。<br/>
因为编译时有指定-soname参数为 libmylib.so.1 的关系，所以该执行档会加载libmylib.so.1。否则以libmylib.so连结，执行档则会变成要求加载libmylib.so
$ ./a.out<br/>
./a.out: error while loading shared libraries: libmylib.so.1:<br/>
cannot open shared object file: No such file or directory<br/>
因为找不到 libmylib.so.1 所以无法执行程序。<br/>
有几个方式可以处理。<br/>
a. 把 libmylib.so.1 安装到系统的library目录，如/usr/lib下<br/>
b. 设定 /etc/ld.so.conf ，加入一个新的library搜寻目录，并执行ldconfig<br/>
更新快取<br/>
c. 设定 LD_LIBRARY_PATH 环境变量来搜寻library<br/>
这个例子是加入当前目录来搜寻要载作的library<br/>
$ LD_LIBRARY_PATH=. ./a.out<br/>
Hello world.</p>

<h4>3. Dynamically loaded libraries</h4>

<p>Dynamicaaly loaded libraries 才是像 windows 所用的 DLL ，在使用到<br/>
时才加载，编译连结时不需要相关的library。动态载入库常被用于像plug-ins的应用。</p>

<h5>3.1 使用方式</h5>

<p>动态加载是透过一套 dl function来处理。<br/>
    #include &lt;dlfcn.h><br/>
    void *dlopen(const char *filename, int flag);<br/>
开启加载 filename 指定的 library。<br/>
    void *dlsym(void *handle, const char *symbol);<br/>
取得 symbol 指定的symbol name在library被加载的内存地址。<br/>
    int dlclose(void *handle);<br/>
关闭dlopen开启的handle。<br/>
    char *dlerror(void);<br/>
传回最近所发生的错误讯息。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>____ dltest.c ____
</span><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;stdlib.h&gt;
</span><span class='line'>#include &lt;stddef.h&gt;
</span><span class='line'>#include &lt;dlfcn.h&gt;
</span><span class='line'>int main() {
</span><span class='line'>void *handle;
</span><span class='line'>void (*f)();
</span><span class='line'>char *error;
</span><span class='line'>/* 开启之前所撰写的 libmylib.so 链接库 */
</span><span class='line'>handle = dlopen("./libmylib.so", RTLD_LAZY);
</span><span class='line'>if( !handle ) {
</span><span class='line'>fputs( dlerror(), stderr);
</span><span class='line'>exit(1);
</span><span class='line'>}
</span><span class='line'>/* 取得 hello function 的 address */
</span><span class='line'>f = dlsym(handle, "hello");
</span><span class='line'>if(( error=dlerror())!=NULL) {
</span><span class='line'>fputs(error, stderr);
</span><span class='line'>exit(1);
</span><span class='line'>}
</span><span class='line'>/* 呼叫该 function */
</span><span class='line'>f();
</span><span class='line'>dlclose(handle);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>编译时要加上 -ldl 参数来与 dl library 连结<br/>
$ gcc dltest.c -ldl<br/>
结果会印出 Hello 字符串<br/>
$ ./a.out<br/>
Hello<br/>
关于dl的详细内容请参阅 man dlopen</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[高精度定时器 high-cpu-load]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/06/debug-mark-sleep/"/>
    <updated>2014-11-06T14:30:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/06/debug-mark-sleep</id>
    <content type="html"><![CDATA[<p><a href="http://stackoverflow.com/questions/1125297/nanosleep-high-cpu-usage">http://stackoverflow.com/questions/1125297/nanosleep-high-cpu-usage</a></p>

<p>I noticed that a little test program which calls nanosleep is showing a huge difference in CPU usage when run on Linux machines with a kernel newer than 2.6.22.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;time.h&gt;
</span><span class='line'>int main (void)
</span><span class='line'>{
</span><span class='line'>    struct timespec sleepTime;
</span><span class='line'>    struct timespec returnTime;
</span><span class='line'>    sleepTime.tv_sec = 0;
</span><span class='line'>    sleepTime.tv_nsec = 1000;
</span><span class='line'>    while (1)
</span><span class='line'>    {
</span><span class='line'>        nanosleep(&sleepTime, &returnTime); // usleep(1); 同样异常
</span><span class='line'>    }
</span><span class='line'>    return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>(Yes, I realise this program does nothing)</p>

<p>  If I compile this and run it on an openSUSE 10.3 machine (2.6.22.19-0.2-default), the program does not even show up on the process list generated by &ldquo;top&rdquo;, indicating to me that it is using very little CPU time.  If I run it on an openSUSE 11.1 machine (2.6.27.23-0.1-default), top shows the program taking 40% of the CPU time.  Running on Fedora 9 (2.6.25-14.fc9.i686) and Fedora 10 also showed the same high CPU usage in &ldquo;top&rdquo;.</p>

<p>Has there been a change in the kernel that affects this?</p>

<hr />

<h4>Answers</h4>

<p>This is due to the introduction of NO_HZ into the mainline scheduler.</p>

<p>Previously, your 1,000 ns sleep was usually sleeping for a whole tick - 1,000,000 ns.  Now, when the machine is otherwise idle, it&rsquo;s actually only sleeping for what you asked for.  So it&rsquo;s running the while() loop and syscall around 1,000 times more frequently - hence a lot more CPU usage.  If you increase tv_nsec you should see a reduction in the CPU usage.</p>

<hr />

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int nanosleep(const struct timespec *req, struct timespec *rem);
</span><span class='line'>
</span><span class='line'>struct timespec
</span><span class='line'>{
</span><span class='line'>    time_t  tv_sec;         /* seconds */
</span><span class='line'>    long    tv_nsec;        /* nanoseconds */
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p> 这个函数功能是暂停某个进程直到你规定的时间后恢复，参数req就是你要暂停的时间，其中req->tv_sec是以秒为单位，而tv_nsec以毫 微秒为单位（10的-9次方秒）。由于调用nanosleep是是进程进入TASK_INTERRUPTIBLE,这种状态是会相应信号而进入 TASK_RUNNING状态的，这就意味着有可能会没有等到你规定的时间就因为其它信号而唤醒，此时函数返回-1，切还剩余的时间会被记录在rem中。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[crash vs gdb work]]></title>
    <link href="http://abcdxyzk.github.io/blog/2014/11/06/debug-crash-work/"/>
    <updated>2014-11-06T10:51:00+08:00</updated>
    <id>http://abcdxyzk.github.io/blog/2014/11/06/debug-crash-work</id>
    <content type="html"><![CDATA[<p><a href="https://www.redhat.com/archives/crash-utility/2014-October/msg00002.html">贴自https://www.redhat.com/archives/crash-utility/2014-October/msg00002.html</a><br/>
Yes, sure. GDB works very differently from crash. There main conceptual<br/>
difference is that GDB only handles with VIRTUAL addresses, while the<br/>
crash utility first translates everything to PHYSICAL addresses.<br/>
Consequently, GDB ignores the PhysAddr field in ELF program headers,<br/>
and crash ignores the VirtAddr field.</p>

<p>I have looked at some of my ELF dump files, and it seems to me that<br/>
VirtAddr is not filled correctly, except for kernel text and static<br/>
data (address range 0xffffffff80000000-0xffffffff9fffffff). Your linked<br/>
list is most likely allocated in the direct mapping<br/>
(0xffff880000000000-0xffffc7ffffffffff). However, I found out that the<br/>
virtual addresses for the direct mapping segments are wrong, e.g. my<br/>
dump file specifies it at 0xffff810000000000 (hypervisor area). This is<br/>
most likely a bug in the kernel code that implements /proc/vmcore.</p>

<p>But that&rsquo;s beside the point. Why?  The Linux kernel maps many physical<br/>
pages more than once into the virtual address space. It would be waste<br/>
of space if you saved it multiple times (for each virtual address that<br/>
maps to it). The crash utility can translate each virtual address to<br/>
the physical address and map it onto ELF segments using PhysAddr.<br/>
Incidentally, the PhysAddr fields are correct in my dump files&hellip;</p>

<p>I&rsquo;m glad you&rsquo;re interested in using GDB to read kernel dump files,<br/>
especially if you&rsquo;re willing to make it work for real. I have proposed<br/>
more than once that the crash utility be re-implemented in pure gdb.<br/>
Last time I looked (approx. 1.5 years ago) the main missing pieces were:</p>

<ol>
<li> Use of physical addresses (described above)</li>
<li> Support for multiple virtual address spaces (for different process<br/>
 contexts)</li>
<li> Ability to read compressed kdump files</li>
<li> Ability to use 64-bit files on 32-bit platforms (to handle PAE)</li>
</ol>


<p>HTH,<br/>
Petr Tesarik</p>
]]></content>
  </entry>
  
</feed>
